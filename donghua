print("å¯¹äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå°åŠ¨ç”»ğŸ˜¶")
print("è¯è¯´ï¼Œä½ æ€ä¹ˆæ¥çœ‹æ§åˆ¶å°äº†ï¼ŸğŸ¤”")
print("å¥½å§ï¼Œæ­å–œä½ å‘ç°äº†æˆ‘è¿™æ®µè¯ğŸ¤—")
print("ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘å‰é¢ä¸¤ä¸ªå­—è¦åŠ é€—å·ï¼ŸğŸ§")
print("æ¸”ç‚’é±¼")
-- ============================================
-- è¿åŠ¨ä¸­äº¤äº’å¼å›¾ç‰‡åŠ¨ç”» v4.0
-- å…¨ç¨‹å¯äº¤äº’ + å¯å…³é—­
-- ============================================

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local SoundService = game:GetService("SoundService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local Camera = workspace.CurrentCamera

-- ========== å…¨å±€æ§åˆ¶å˜é‡ ==========
local IsAnimationPlaying = true
local CanInteract = false  -- äº¤äº’å¼€å…³

-- ========== åˆ›å»ºå±•ç¤ºç•Œé¢ ==========
local ShowcaseScreen = Instance.new("ScreenGui")
ShowcaseScreen.Name = "MovingInteractiveImage"
ShowcaseScreen.ResetOnSpawn = false
ShowcaseScreen.ZIndexBehavior = Enum.ZIndexBehavior.Global
ShowcaseScreen.IgnoreGuiInset = true
ShowcaseScreen.Parent = PlayerGui

-- å…³é—­æŒ‰é’®ï¼ˆå§‹ç»ˆå¯è§ï¼‰
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.BackgroundColor3 = Color3.new(0.9, 0.2, 0.2)
CloseButton.BackgroundTransparency = 0.3
CloseButton.Size = UDim2.new(0, 40, 0, 40)
CloseButton.Position = UDim2.new(1, -50, 0, 10)
CloseButton.ZIndex = 100
CloseButton.Parent = ShowcaseScreen

-- åœ†è§’
local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 8)
closeCorner.Parent = CloseButton

-- æŒ‰é’®æ‚¬åœæ•ˆæœ
CloseButton.MouseEnter:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0,
        Size = UDim2.new(0, 45, 0, 45)
    }):Play()
end)

CloseButton.MouseLeave:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.3,
        Size = UDim2.new(0, 40, 0, 40)
    }):Play()
end)

-- å…³é—­åŠŸèƒ½
CloseButton.MouseButton1Click:Connect(function()
    IsAnimationPlaying = false
    CanInteract = false
    
    -- æ’­æ”¾å…³é—­éŸ³æ•ˆ
    local closeSound = Instance.new("Sound")
    closeSound.SoundId = "rbxassetid://138080526"
    closeSound.Volume = 0.3
    closeSound.Parent = SoundService
    closeSound:Play()
    closeSound.Ended:Connect(function() closeSound:Destroy() end)
    
    -- å¿«é€Ÿå…³é—­åŠ¨ç”»
    TweenService:Create(CloseButton, TweenInfo.new(0.1), {
        BackgroundColor3 = Color3.new(0.7, 0.1, 0.1),
        Size = UDim2.new(0, 35, 0, 35)
    }):Play()
    
    task.wait(0.1)
    
    TweenService:Create(CloseButton, TweenInfo.new(0.1), {
        BackgroundColor3 = Color3.new(0.9, 0.2, 0.2),
        Size = UDim2.new(0, 40, 0, 40)
    }):Play()
    
    task.wait(0.1)
    ShowcaseScreen:Destroy()
    
    -- æ¸…ç†æ¨¡ç³Šæ•ˆæœ
    local blur = Lighting:FindFirstChild("ScreenBlur")
    if blur then blur:Destroy() end
end)

-- åˆ›å»ºèƒŒæ™¯æ¨¡ç³Šæ•ˆæœ
local function createBlurEffect()
    local blur = Instance.new("BlurEffect")
    blur.Name = "ScreenBlur"
    blur.Size = 0
    blur.Parent = Lighting
    return blur
end

-- æ·±è‰²æ¸å˜èƒŒæ™¯
local Background = Instance.new("Frame")
Background.Name = "Background"
Background.BackgroundColor3 = Color3.new(0.03, 0.03, 0.05)
Background.BackgroundTransparency = 1
Background.Size = UDim2.new(1, 0, 1, 0)
Background.Parent = ShowcaseScreen

local bgGradient = Instance.new("UIGradient")
bgGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.new(0.02, 0.02, 0.03)),
    ColorSequenceKeypoint.new(1, Color3.new(0.04, 0.04, 0.07))
})
bgGradient.Rotation = 135
bgGradient.Parent = Background

-- ä¸»å›¾ç‰‡å®¹å™¨
local ImageContainer = Instance.new("Frame")
ImageContainer.Name = "ImageContainer"
ImageContainer.BackgroundTransparency = 1
ImageContainer.Size = UDim2.new(1, 0, 1, 0)
ImageContainer.Parent = ShowcaseScreen

-- ========== åˆ›å»ºè¿åŠ¨ä¸­çš„å¯äº¤äº’å›¾ç‰‡ ==========
local ImageLayers = {}
local LayerCount = 3  -- æ›´å°‘å±‚æ•°ï¼Œæ›´æ¸…æ™°
local MovementConnections = {}  -- è¿åŠ¨è¿æ¥å­˜å‚¨

for i = 1, LayerCount do
    local layer = Instance.new("ImageButton")
    layer.Name = "MovingImage_" .. i
    layer.Image = "rbxassetid://111333374680640"
    layer.BackgroundTransparency = 1
    layer.AnchorPoint = Vector2.new(0.5, 0.5)
    layer.Position = UDim2.new(0.5, 0, 1.5, 0)
    layer.Size = UDim2.new(0, 30, 0, 30)
    layer.ImageTransparency = 1
    layer.ZIndex = i * 10  -- æ›´é«˜å±‚çº§
    layer.AutoButtonColor = false
    layer.Active = true
    layer.Selectable = true
    layer.Parent = ImageContainer
    
    -- åˆå§‹é¢œè‰²
    local hue = 0.7 + (i-1) * 0.08
    layer.ImageColor3 = Color3.fromHSV(hue, 0.12, 1)
    
    -- ç‚¹å‡»è¾¹æ¡†
    local clickBorder = Instance.new("UIStroke")
    clickBorder.Name = "ClickBorder"
    clickBorder.Color = Color3.fromHSV(hue, 0.25, 0.9)
    clickBorder.Thickness = 0
    clickBorder.Transparency = 1
    clickBorder.Parent = layer
    
    -- æ‚¬åœæ•ˆæœ
    layer.MouseEnter:Connect(function()
        if CanInteract then
            TweenService:Create(clickBorder, TweenInfo.new(0.25), {
                Thickness = 2.5,
                Transparency = 0.4
            }):Play()
        end
    end)
    
    layer.MouseLeave:Connect(function()
        if CanInteract then
            TweenService:Create(clickBorder, TweenInfo.new(0.25), {
                Thickness = 0,
                Transparency = 1
            }):Play()
        end
    end)
    
    ImageLayers[i] = layer
    MovementConnections[i] = nil
end

-- ä¸»å›¾ç‰‡
local MainImage = ImageLayers[1]
MainImage.ImageColor3 = Color3.new(1, 1, 1)

-- ========== è¿åŠ¨ä¸­çš„äº¤äº’å“åº” ==========
local function handleMovingClick(layerIndex)
    if not CanInteract or not IsAnimationPlaying then return end
    
    local layer = ImageLayers[layerIndex]
    if not layer then return end
    
    -- ç‚¹å‡»éŸ³æ•ˆ
    local clickSound = Instance.new("Sound")
    clickSound.SoundId = "rbxassetid://278549903"
    clickSound.Volume = 0.18
    clickSound.Parent = SoundService
    clickSound:Play()
    clickSound.Ended:Connect(function() clickSound:Destroy() end)
    
    -- è„‰å†²åŠ¨ç”»ï¼ˆä¸å½±å“è¿åŠ¨ï¼‰
    local originalSize = layer.Size
    local pulseAnim = {
        TweenService:Create(layer, TweenInfo.new(0.08), {
            Size = UDim2.new(0, originalSize.X.Offset * 0.85, 0, originalSize.Y.Offset * 0.85)
        }),
        TweenService:Create(layer, TweenInfo.new(0.22, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out), {
            Size = originalSize
        })
    }
    
    pulseAnim[1]:Play()
    pulseAnim[1].Completed:Wait()
    pulseAnim[2]:Play()
    
    -- ç‚¹å‡»å…‰æ™•
    local clickGlow = Instance.new("Frame")
    clickGlow.Name = "ClickGlow"
    clickGlow.BackgroundColor3 = layer.ImageColor3
    clickGlow.BackgroundTransparency = 0.75
    clickGlow.Size = UDim2.new(0, 15, 0, 15)
    clickGlow.AnchorPoint = Vector2.new(0.5, 0.5)
    clickGlow.Position = layer.Position
    clickGlow.ZIndex = layer.ZIndex - 5
    clickGlow.Parent = ImageContainer
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = clickGlow
    
    -- å…‰æ™•æ‰©æ•£
    TweenService:Create(clickGlow, TweenInfo.new(0.6), {
        Size = UDim2.new(0, 120, 0, 120),
        BackgroundTransparency = 1
    }):Play()
    
    task.wait(0.6)
    clickGlow:Destroy()
    
    -- é¢œè‰²å¾®è°ƒ
    local currentColor = layer.ImageColor3
    local h, s, v = currentColor:ToHSV()
    local newHue = (h + 0.05) % 1
    
    TweenService:Create(layer, TweenInfo.new(0.4), {
        ImageColor3 = Color3.fromHSV(newHue, math.min(s + 0.03, 0.2), v)
    }):Play()
end

-- ç»‘å®šç‚¹å‡»äº‹ä»¶
for i, layer in ipairs(ImageLayers) do
    layer.MouseButton1Click:Connect(function()
        handleMovingClick(i)
    end)
end

-- ========== åˆ›å»ºè¿åŠ¨è½¨è¿¹æ•ˆæœ ==========
local function createMotionTrails()
    local trailsContainer = Instance.new("Frame")
    trailsContainer.Name = "MotionTrails"
    trailsContainer.BackgroundTransparency = 1
    trailsContainer.Size = UDim2.new(1, 0, 1, 0)
    trailsContainer.ZIndex = -10
    trailsContainer.Parent = ImageContainer
    
    return trailsContainer
end

-- ========== è¿åŠ¨ç³»ç»Ÿ ==========
local function startLayerMovement(layerIndex, delayTime)
    if not IsAnimationPlaying then return nil end
    
    local layer = ImageLayers[layerIndex]
    if not layer then return nil end
    
    local trailContainer = ImageContainer:FindFirstChild("MotionTrails")
    if not trailContainer then return nil end
    
    -- åˆ›å»ºè½¨è¿¹ç‚¹
    local lastPositions = {}
    local maxTrailLength = 8
    
    -- è¿åŠ¨å¾ªç¯
    local movementThread = task.spawn(function()
        task.wait(delayTime)
        
        while IsAnimationPlaying do
            -- ç”Ÿæˆéšæœºè¿åŠ¨ç›®æ ‡ï¼ˆåœ¨å±å¹•èŒƒå›´å†…ï¼‰
            local targetX = 0.3 + math.random() * 0.4  -- å±å¹•ä¸­é—´70%åŒºåŸŸ
            local targetY = 0.3 + math.random() * 0.4
            local targetRotation = math.random(-30, 30)
            local moveTime = 2.5 + math.random() * 1.5  -- è¿åŠ¨æ—¶é—´
            
            -- å¦‚æœå…è®¸äº¤äº’ï¼Œè¿åŠ¨æ›´å¹³æ»‘
            if CanInteract then
                moveTime = moveTime * 1.2
            end
            
            -- è¿åŠ¨åŠ¨ç”»
            local movementTween = TweenService:Create(layer, TweenInfo.new(
                moveTime,
                Enum.EasingStyle.Sine,
                Enum.EasingDirection.InOut
            ), {
                Position = UDim2.new(targetX, 0, targetY, 0),
                Rotation = targetRotation
            })
            
            -- åˆ›å»ºè½¨è¿¹ç‚¹
            if CanInteract and IsAnimationPlaying then
                local trailDot = Instance.new("Frame")
                trailDot.Name = "TrailDot_" .. tick()
                trailDot.BackgroundColor3 = layer.ImageColor3
                trailDot.BackgroundTransparency = 0.85
                trailDot.Size = UDim2.new(0, 8, 0, 8)
                trailDot.AnchorPoint = Vector2.new(0.5, 0.5)
                trailDot.Position = layer.Position
                trailDot.ZIndex = layer.ZIndex - 1
                trailDot.Parent = trailContainer
                
                local corner = Instance.new("UICorner")
                corner.CornerRadius = UDim.new(1, 0)
                corner.Parent = trailDot
                
                -- è½¨è¿¹ç‚¹æ·¡å‡º
                TweenService:Create(trailDot, TweenInfo.new(1.5), {
                    BackgroundTransparency = 1,
                    Size = UDim2.new(0, 2, 0, 2)
                }):Play()
                
                -- è®°å½•ä½ç½®
                table.insert(lastPositions, {
                    dot = trailDot,
                    time = tick()
                })
                
                -- æ¸…ç†æ—§è½¨è¿¹
                while #lastPositions > maxTrailLength do
                    local oldTrail = table.remove(lastPositions, 1)
                    if oldTrail.dot then
                        oldTrail.dot:Destroy()
                    end
                end
                
                -- è‡ªåŠ¨æ¸…ç†è½¨è¿¹ç‚¹
                task.delay(2, function()
                    if trailDot and trailDot.Parent then
                        trailDot:Destroy()
                    end
                end)
            end
            
            -- ç­‰å¾…è¿åŠ¨å®Œæˆæˆ–ä¸­æ–­
            movementTween:Play()
            local startTime = tick()
            while tick() - startTime < moveTime and IsAnimationPlaying do
                task.wait(0.1)
            end
            
            if not IsAnimationPlaying then break end
            
            -- çŸ­æš‚æš‚åœ
            local pauseTime = 0.8 + math.random() * 0.4
            task.wait(pauseTime)
        end
    end)
    
    return movementThread
end

-- ========== ä¸»åŠ¨ç”»åºåˆ— ==========
local function playMovingInteractiveAnimation()
    -- åˆ›å»ºæ•ˆæœ
    local screenBlur = createBlurEffect()
    local trailsContainer = createMotionTrails()
    
    -- èƒŒæ™¯å’Œæ¨¡ç³Šæ·¡å…¥
    local bgFade = TweenService:Create(Background, TweenInfo.new(2.5), {
        BackgroundTransparency = 0.88
    })
    bgFade:Play()
    
    local blurFade = TweenService:Create(screenBlur, TweenInfo.new(2), {
        Size = 10
    })
    blurFade:Play()
    
    -- å›¾ç‰‡å‡èµ·å…¥åœº
    for i, layer in ipairs(ImageLayers) do
        local riseTime = 1.8
        local delay = (i-1) * 0.3
        
        task.wait(delay)
        
        TweenService:Create(layer, TweenInfo.new(riseTime, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Position = UDim2.new(0.5, math.sin(i) * 100, 0.5, 0),
            Size = UDim2.new(0, 180 + i*20, 0, 180 + i*20),
            ImageTransparency = 0.1
        }):Play()
    end
    
    task.wait(3.0)
    
    -- å¯ç”¨äº¤äº’
    CanInteract = true
    
    -- æ˜¾ç¤ºäº¤äº’æç¤º
    local hintLabel = Instance.new("TextLabel")
    hintLabel.Name = "HintLabel"
    hintLabel.Text = "ğŸ–±ï¸ ç‚¹å‡»å›¾ç‰‡äº’åŠ¨ | âœ• å…³é—­"
    hintLabel.TextColor3 = Color3.new(0.9, 0.9, 0.9)
    hintLabel.TextSize = 14
    hintLabel.Font = Enum.Font.SourceSansSemibold
    hintLabel.BackgroundColor3 = Color3.new(0.1, 0.1, 0.15)
    hintLabel.BackgroundTransparency = 0.7
    hintLabel.Size = UDim2.new(0, 200, 0, 30)
    hintLabel.Position = UDim2.new(0.5, -100, 1, -50)
    hintLabel.AnchorPoint = Vector2.new(0.5, 0)
    hintLabel.ZIndex = 90
    hintLabel.Parent = ShowcaseScreen
    
    local hintCorner = Instance.new("UICorner")
    hintCorner.CornerRadius = UDim.new(0, 6)
    hintCorner.Parent = hintLabel
    
    -- æç¤ºæ·¡å…¥
    TweenService:Create(hintLabel, TweenInfo.new(0.8), {
        BackgroundTransparency = 0.3,
        Position = UDim2.new(0.5, -100, 1, -40)
    }):Play()
    
    -- å¼€å§‹è¿åŠ¨ç³»ç»Ÿ
    for i, layer in ipairs(ImageLayers) do
        MovementConnections[i] = startLayerMovement(i, i * 0.5)
    end
    
    -- ä¿æŒè¿åŠ¨15ç§’
    local startTime = tick()
    while tick() - startTime < 15 and IsAnimationPlaying do
        task.wait(0.5)
    end
    
    if not IsAnimationPlaying then return end
    
    -- å…³é—­äº¤äº’
    CanInteract = false
    
    -- ç§»é™¤æç¤º
    TweenService:Create(hintLabel, TweenInfo.new(0.8), {
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, -100, 1, -30)
    }):Play()
    
    task.wait(0.8)
    hintLabel:Destroy()
    
    -- åœæ­¢è¿åŠ¨
    for i = 1, LayerCount do
        if MovementConnections[i] then
            task.cancel(MovementConnections[i])
            MovementConnections[i] = nil
        end
    end
    
    -- æ¸…ç†è½¨è¿¹
    trailsContainer:Destroy()
    
    -- å›¾ç‰‡èšé›†åˆ°ä¸­å¿ƒ
    for i, layer in ipairs(ImageLayers) do
        TweenService:Create(layer, TweenInfo.new(1.5), {
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 140, 0, 140),
            Rotation = 0
        }):Play()
    end
    
    task.wait(1.5)
    
    -- èƒŒæ™¯æ¨¡ç³Šå‡å°‘
    TweenService:Create(screenBlur, TweenInfo.new(1.5), {
        Size = 4
    }):Play()
    
    -- èƒŒæ™¯æ·¡å‡º
    TweenService:Create(Background, TweenInfo.new(1.5), {
        BackgroundTransparency = 1
    }):Play()
    
    -- å›¾ç‰‡æ—‹è½¬ä¸Šå‡æ¶ˆå¤±
    for i, layer in ipairs(ImageLayers) do
        TweenService:Create(layer, TweenInfo.new(2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Position = UDim2.new(0.5, 0, -0.2, 0),
            Size = UDim2.new(0, 60, 0, 60),
            ImageTransparency = 1,
            Rotation = layer.Rotation + 180
        }):Play()
    end
    
    task.wait(2.0)
    
    -- å®Œå…¨ç§»é™¤æ¨¡ç³Š
    TweenService:Create(screenBlur, TweenInfo.new(0.8), {
        Size = 0
    }):Play()
    
    task.wait(0.8)
    screenBlur:Destroy()
    
    -- æœ€ç»ˆæ¸…ç†
    task.wait(0.5)
    ShowcaseScreen:Destroy()
end

-- ========== å¯åŠ¨åŠ¨ç”» ==========
task.wait(0.5)
playMovingInteractiveAnimation()

-- é‡æ–°æ’­æ”¾æŒ‰é”®
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.R then
        if ShowcaseScreen and ShowcaseScreen.Parent then
            ShowcaseScreen:Destroy()
        end
        loadstring(script.Source)()
    end
end)