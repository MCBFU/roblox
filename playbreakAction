-- ============== ç¬¬ä¸€éƒ¨åˆ†ï¼šåŠ¨ä½œå·¥å…·ç®±ï¼ˆå…¨é‡é”™è¯¯ä¿®å¤å®Œæˆï¼‰ ==============
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- åŠ¨ä½œIDæ•°æ®åº“ï¼ˆç¡®ä¿IDéƒ½æ˜¯æ•°å­—ï¼Œä¿®æ­£éƒ¨åˆ†è¶…é•¿IDæ ¼å¼ï¼‰
local ActionDatabase = {
    {Name = "è¶´ç€è¡Œèµ°(ä»¥ä¸‹å†…å®¹ä»…ä¾›æœºå™¨äººå’Œä¸“å®¶ä½¿ç”¨)", ID = 17831576933},
    {Name = "è¹²ç€èµ°", ID = 106507840912725},
    {Name = "éåœ°", ID = 17844403413},
    {Name = "å è½", ID = 17873485539},
    {Name = "è¡ç§‹åƒ", ID = 15778110442},
    {Name = "å—åˆ°æ”»å‡»", ID = 17753481871},
    {Name = "æ‹¥æŠ±è·³æ€", ID = 91334897253452},
    {Name = "è¢«è·³æ€", ID = 115775718621189},
    {Name = "æ”»å‡»", ID = 125989772267746},
    {Name = "è…¿ç˜¸è¡Œèµ°", ID = 70544076185126},
    {Name = "è½åœ°", ID = 80339425536454},
    {Name = "æŠ±å¤´", ID = 136904105579436},
    {Name = "æœºå™¨äººä¸¾èµ·ç©å®¶", ID = 84687585017584},
    {Name = "æ€ªç‰©éšèº«(ä»¥ä¸‹å†…å®¹ä¸“ä¸ºå“ˆå‰ä½¿ç”¨)", ID = 135392429980132},
    {Name = "æ€ªç‰©éšèº«2", ID = 86109702723649},
    {Name = "å“ˆå‰ç«™", ID = 13068559211},
    {Name = "å“ˆå‰ç«™2", ID = 137610829519848},
    {Name = "å“ˆå‰ç‹‚æš´", ID = 111268763265056},
    {Name = "å“ˆå‰ç‹‚æš´æ™®æ”»", ID = 105957541008868},
    {Name = "å“ˆå‰æ™®æ”»", ID = 90277841872284},
    {Name = "å“ˆå‰èµ°", ID = 73116337474484},
    {Name = "å“ˆå‰è¹²èµ°", ID = 86947765272915},
    {Name = "å“ˆå‰æŠ¬æ‰‹", ID = 86947765272915},  -- é‡å¤IDä¿ç•™ï¼ŒæŒ‰è®¾å®šæ¥
    {Name = "å“ˆå‰è·³è·ƒ", ID = 129959586618668},
    {Name = "å“ˆå‰æŠ±æŠ±", ID = 105996289017723},
    {Name = "å“ˆå‰ç‹‚æš´è·‘", ID = 116476862154793},
    {Name = "å¦ˆå’ªé¬¼ç•œ", ID = 108173637615786},
    {Name = "ä¸åœæ”»å‡»", ID = 95730021935791},
    {Name = "è¡Œèµ°", ID = 83416070615592},
    {Name = "å è½", ID = 127744227683072},
    {Name = "çªè„¸", ID = 110430212023173},
    {Name = "å¦ˆå’ªè½¬èº«", ID = 138698134374418},
}

-- åˆ›å»ºä¸»ç•Œé¢
local ActionToolbox = Instance.new("ScreenGui")
ActionToolbox.Name = "ActionToolbox"
ActionToolbox.ResetOnSpawn = false
ActionToolbox.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ä¸»çª—å£
local MainWindow = Instance.new("Frame")
MainWindow.Name = "MainWindow"
MainWindow.Size = UDim2.new(0, 280, 0, 420)
MainWindow.Position = UDim2.new(0.5, -140, 0.5, -210)
MainWindow.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainWindow.BorderSizePixel = 0
MainWindow.ClipsDescendants = true

-- åœ†è§’
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainWindow

-- æ ‡é¢˜æ ï¼ˆä¿®å¤åŸä»£ç Sizeé”™è¯¯ï¼‰
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 45)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
TitleBar.BorderSizePixel = 0

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -120, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "åŠ¨ä½œå·¥å…·ç®±"
Title.TextColor3 = Color3.fromRGB(220, 220, 230)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

-- ç¼©å°æŒ‰é’®
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -75, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 130, 200)
MinimizeButton.AutoButtonColor = false
MinimizeButton.Text = "ï¼"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 18

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

-- å…³é—­æŒ‰é’®
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
CloseButton.AutoButtonColor = false
CloseButton.Text = "Ã—"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- æ¸…é™¤æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
local ClearAllButton = Instance.new("TextButton")
ClearAllButton.Name = "ClearAllButton"
ClearAllButton.Size = UDim2.new(1, -20, 0, 40)
ClearAllButton.Position = UDim2.new(0, 10, 0, 50)
ClearAllButton.BackgroundColor3 = Color3.fromRGB(180, 70, 70)
ClearAllButton.AutoButtonColor = true
ClearAllButton.Text = "æ¸…é™¤æ‰€æœ‰åŠ¨ä½œ"
ClearAllButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ClearAllButton.Font = Enum.Font.GothamBold
ClearAllButton.TextSize = 14
ClearAllButton.TextWrapped = true

local ClearCorner = Instance.new("UICorner")
ClearCorner.CornerRadius = UDim.new(0, 6)
ClearCorner.Parent = ClearAllButton

local ClearStroke = Instance.new("UIStroke")
ClearStroke.Color = Color3.fromRGB(200, 90, 90)
ClearStroke.Thickness = 1
ClearStroke.Parent = ClearAllButton

-- å†…å®¹åŒºåŸŸ
local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Size = UDim2.new(1, -20, 1, -110)
Content.Position = UDim2.new(0, 10, 0, 100)
Content.BackgroundTransparency = 1

-- æ»šåŠ¨æ¡†ï¼ˆä¿®å¤åŸä»£ç æ‹¼å†™é”™è¯¯ ScrollingFrameï¼‰
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Name = "ScrollingFrame"
ScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
ScrollingFrame.BackgroundTransparency = 1
ScrollingFrame.BorderSizePixel = 0
ScrollingFrame.ScrollBarThickness = 4
ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 90)
ScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)

-- åŠ¨ä½œæŒ‰é’®å®¹å™¨
local ActionsListLayout = Instance.new("UIListLayout")
ActionsListLayout.Padding = UDim.new(0, 8)
ActionsListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- ç»„è£…UIï¼ˆä¿®å¤å±‚çº§é”™è¯¯ï¼‰
TitleBar.Parent = MainWindow
Title.Parent = TitleBar
MinimizeButton.Parent = TitleBar
CloseButton.Parent = TitleBar
ClearAllButton.Parent = MainWindow
Content.Parent = MainWindow
ScrollingFrame.Parent = Content
ActionsListLayout.Parent = ScrollingFrame

MainWindow.Parent = ActionToolbox
ActionToolbox.Parent = player:WaitForChild("PlayerGui")

-- çŠ¶æ€å˜é‡
local isMinimized = false
local originalSize = MainWindow.Size
local originalPosition = MainWindow.Position
local minimizedSize = UDim2.new(0, 200, 0, 40)
local dragging = false
local dragStart, startPos

-- å½“å‰æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»
local currentAnimations = {}

-- ========== ä¿®å¤ï¼šåŠ¨ç”»æ’­æ”¾ç³»ç»Ÿ ==========
local function getHumanoid()
    -- è·å–å½“å‰è§’è‰²çš„Humanoid
    if not character or not character.Parent then
        character = player.Character
    end

    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            return humanoid
        end
        -- ç­‰å¾…HumanoidåŠ è½½
        local humanoidWait = character:WaitForChild("Humanoid", 3)
        return humanoidWait
    end
    return nil
end

local function playAnimation(animationId, animationName)
    -- è·å–Humanoid
    local humanoid = getHumanoid()
    if not humanoid then
        warn("æ— æ³•æ‰¾åˆ°Humanoidï¼")
        return
    end

    -- åœæ­¢åŒåçš„åŠ¨ç”»
    if currentAnimations[animationName] then
        currentAnimations[animationName]:Stop()
        currentAnimations[animationName] = nil
    end

    -- åˆ›å»ºå¹¶åŠ è½½åŠ¨ç”»
    local success, result = pcall(function()
        local animation = Instance.new("Animation")
        -- ç¡®ä¿animationIdæ˜¯æ•°å­—ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼
        local animId = tonumber(animationId)
        if animId then
            animation.AnimationId = "rbxassetid://" .. animId
        else
            animation.AnimationId = animationId
        end

        -- åŠ è½½åŠ¨ç”»
        local animTrack = humanoid:LoadAnimation(animation)
        animTrack:Play()
        animation:Destroy() -- ç”¨å®Œé”€æ¯ï¼Œé¿å…å†…å­˜æ³„æ¼

        -- ä¿å­˜åŠ¨ç”»å¼•ç”¨
        currentAnimations[animationName] = animTrack

        -- ç›‘å¬åŠ¨ç”»ç»“æŸ
        animTrack.Stopped:Connect(function()
            currentAnimations[animationName] = nil
        end)

        print("âœ… æ­£åœ¨æ’­æ”¾: " .. animationName .. " (ID: " .. animationId .. ")")
        return animTrack
    end)

    if not success then
        warn("âŒ æ’­æ”¾åŠ¨ç”»å¤±è´¥: " .. animationName)
        warn("é”™è¯¯ä¿¡æ¯: " .. tostring(result))
    end
end

-- æ¸…é™¤æ‰€æœ‰åŠ¨ç”»å‡½æ•°ï¼ˆä¿®å¤åœæ­¢åŠ¨ç”»é€»è¾‘æ¼æ´ï¼‰
local function clearAllAnimations()
    print("ğŸ”„ æ¸…é™¤æ‰€æœ‰åŠ¨ä½œ...")

    local count = 0
    for animName, animTrack in pairs(currentAnimations) do
        if animTrack and typeof(animTrack) == "Instance" then
            animTrack:Stop()
            count += 1
        end
        currentAnimations[animName] = nil
    end

    -- æ¸…ç©ºåŠ¨ç”»è¡¨
    table.clear(currentAnimations)

    -- æŒ‰é’®åé¦ˆåŠ¨ç”»
    local originalColor = ClearAllButton.BackgroundColor3
    ClearAllButton.BackgroundColor3 = Color3.fromRGB(220, 90, 90)
    ClearAllButton.Text = "å·²æ¸…é™¤ (" .. count .. ")"

    -- æ¢å¤æŒ‰é’®çŠ¶æ€
    task.wait(0.8)
    ClearAllButton.BackgroundColor3 = originalColor
    ClearAllButton.Text = "æ¸…é™¤æ‰€æœ‰åŠ¨ä½œ"

    print("âœ… å·²æ¸…é™¤ " .. count .. " ä¸ªåŠ¨ä½œ")
end

-- åˆ›å»ºåŠ¨ä½œæŒ‰é’®ï¼ˆä¿®å¤æŒ‰é’®é¢œè‰²ä¿®æ”¹æ‹¼å†™é”™è¯¯ï¼‰
local actionButtons = {}
local function createActionButton(actionData, index)
    local button = Instance.new("TextButton")
    button.Name = "Action_" .. index
    button.Size = UDim2.new(1, 0, 0, 45)
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    button.AutoButtonColor = true
    button.Text = ""
    button.LayoutOrder = index
    button.Visible = not isMinimized

    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button

    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = Color3.fromRGB(70, 70, 80)
    buttonStroke.Thickness = 1
    buttonStroke.Parent = button

    -- åŠ¨ä½œåç§°
    local actionName = Instance.new("TextLabel")
    actionName.Name = "ActionName"
    actionName.Size = UDim2.new(1, -20, 1, 0)
    actionName.Position = UDim2.new(0, 10, 0, 0)
    actionName.BackgroundTransparency = 1
    actionName.Text = actionData.Name
    actionName.TextColor3 = Color3.fromRGB(220, 220, 230)
    actionName.Font = Enum.Font.GothamBold
    actionName.TextSize = 14
    actionName.TextXAlignment = Enum.TextXAlignment.Left
    actionName.TextTruncate = Enum.TextTruncate.AtEnd
    actionName.Parent = button

    -- ç‚¹å‡»æ‰§è¡ŒåŠ¨ä½œ
    button.MouseButton1Click:Connect(function()
        local originalColor = button.BackgroundColor3
        button.BackgroundColor3 = Color3.fromRGB(70, 120, 200) -- ä¿®å¤æ‹¼å†™é”™è¯¯ BackgroundColor3

        -- æ’­æ”¾åŠ¨ç”»
        playAnimation(actionData.ID, actionData.Name)

        -- æ¢å¤æŒ‰é’®é¢œè‰²
        task.wait(0.15)
        button.BackgroundColor3 = originalColor
    end)

    -- æ‚¬åœæ•ˆæœ
    button.MouseEnter:Connect(function()
        if not isMinimized then
            local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)})
            tween:Play()
        end
    end)

    button.MouseLeave:Connect(function()
        if not isMinimized then
            local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)})
            tween:Play()
        end
    end)

    table.insert(actionButtons, button)
    return button
end

-- ç”Ÿæˆæ‰€æœ‰åŠ¨ä½œæŒ‰é’®
for i, actionData in ipairs(ActionDatabase) do
    local button = createActionButton(actionData, i)
    button.Parent = ScrollingFrame
end

-- æ¸…é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
ClearAllButton.MouseButton1Click:Connect(clearAllAnimations)

-- æ¸…é™¤æŒ‰é’®æ‚¬åœæ•ˆæœ
ClearAllButton.MouseEnter:Connect(function()
    local tween = TweenService:Create(ClearAllButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(200, 90, 90)})
    tween:Play()
end)

ClearAllButton.MouseLeave:Connect(function()
    local tween = TweenService:Create(ClearAllButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(180, 70, 70)})
    tween:Play()
end)

-- æ‹–åŠ¨åŠŸèƒ½å‡½æ•°
local function updateWindowPosition(input)
    local delta = input.Position - dragStart
    MainWindow.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

-- é€šç”¨æ‹–åŠ¨å¤„ç†å‡½æ•°
local function setupDrag(frame)
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainWindow.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
end

-- è®¾ç½®æ‹–åŠ¨
setupDrag(TitleBar)
setupDrag(MainWindow)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateWindowPosition(input)
    end
end)

-- æœ€å°åŒ–/æœ€å¤§åŒ–åŠŸèƒ½ï¼ˆä¿®å¤UIæ˜¾éšé—æ¼ã€ä½ç½®è¿˜åŸæ¼æ´ï¼‰
local function toggleMinimize()
    isMinimized = not isMinimized
    if isMinimized then
        -- ä¿å­˜å½“å‰å¤§å°å’Œä½ç½®
        originalSize = MainWindow.Size
        originalPosition = MainWindow.Position
        -- éšè—å†…å®¹
        ClearAllButton.Visible = false
        Content.Visible = false
        MinimizeButton.Text = "ï¼‹"
        Title.Text = "åŠ¨ä½œç®±"
        -- åŠ¨ç”»ï¼šç¼©å°
        local tween = TweenService:Create(MainWindow, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = minimizedSize})
        tween:Play()
        -- éšè—æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
        for _, button in ipairs(actionButtons) do
            button.Visible = false
        end
    else
        -- åŠ¨ç”»ï¼šå±•å¼€
        local tween = TweenService:Create(MainWindow, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = originalSize, Position = originalPosition})
        tween:Play()
        -- æ¢å¤æ˜¾ç¤º
        MinimizeButton.Text = "ï¼"
        Title.Text = "åŠ¨ä½œå·¥å…·ç®±"
        ClearAllButton.Visible = true
        Content.Visible = true
        -- æ˜¾ç¤ºæ‰€æœ‰åŠ¨ä½œæŒ‰é’®
        for _, button in ipairs(actionButtons) do
            button.Visible = true
        end
    end
end

-- æœ€å°åŒ–æŒ‰é’®ç‚¹å‡»
MinimizeButton.MouseButton1Click:Connect(toggleMinimize)

-- æŒ‰é’®æ‚¬åœé€šç”¨å‡½æ•°ï¼ˆä¿®å¤æœªå®šä¹‰é”™è¯¯ï¼‰
local function setupButtonHover(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor})
        tween:Play()
    end)
    button.MouseLeave:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor})
        tween:Play()
    end)
end

setupButtonHover(MinimizeButton, Color3.fromRGB(80, 130, 200), Color3.fromRGB(100, 150, 220))
setupButtonHover(CloseButton, Color3.fromRGB(200, 70, 70), Color3.fromRGB(220, 90, 90))

-- å…³é—­åŠŸèƒ½
CloseButton.MouseButton1Click:Connect(function()
    clearAllAnimations()
    ActionToolbox:Destroy()
end)

-- çª—å£æ˜¾ç¤º/éšè—åŠŸèƒ½
local function toggleVisibility()
    MainWindow.Visible = not MainWindow.Visible
end

-- çƒ­é”®æ§åˆ¶
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed then
        if input.KeyCode == Enum.KeyCode.F1 then
            toggleVisibility()
        elseif input.KeyCode == Enum.KeyCode.F2 then
            toggleMinimize()
        elseif input.KeyCode == Enum.KeyCode.F3 then
            clearAllAnimations()
        end
    end
end)

-- è§’è‰²é‡ç”Ÿå¤„ç†
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    task.wait(0.5) -- ç­‰å¾…è§’è‰²å®Œå…¨åŠ è½½
    clearAllAnimations()
end)

-- ============== ç¬¬äºŒéƒ¨åˆ†ï¼šR15å…³èŠ‚ç«‹æ–¹ä½“ç³»ç»Ÿï¼ˆä¿®å¤å…¨é‡é”™è¯¯ï¼‰ ==============
local RunService = game:GetService("RunService")

-- R15å…³èŠ‚æ˜ å°„è¡¨
local R15_JOINTS = {
    -- æ ¸å¿ƒå…³èŠ‚
    "HumanoidRootPart",
    "LowerTorso",
    "UpperTorso",
    -- å¤´éƒ¨
    "Head",
    -- å·¦è‡‚
    "LeftUpperArm", "LeftLowerArm", "LeftHand",
    -- å³è‡‚
    "RightUpperArm", "RightLowerArm", "RightHand",
    -- å·¦è…¿
    "LeftUpperLeg", "LeftLowerLeg", "LeftFoot",
    -- å³è…¿
    "RightUpperLeg", "RightLowerLeg", "RightFoot"
}

-- ç«‹æ–¹ä½“é…ç½®
local CUBE_CONFIG = {
    Size = Vector3.new(0.5, 0.5, 0.5),  -- å°ç«‹æ–¹ä½“
    Colors = {
        Color3.fromRGB(255, 100, 100),  -- çº¢è‰²ç³»
        Color3.fromRGB(100, 255, 100),  -- ç»¿è‰²ç³»
        Color3.fromRGB(100, 100, 255),  -- è“è‰²ç³»
        Color3.fromRGB(255, 255, 100),  -- é»„è‰²ç³»
    },
    Transparency = 0.5,
    Material = Enum.Material.Neon
}

-- å­˜å‚¨æ‰€æœ‰ç«‹æ–¹ä½“
local cubeTable = {}

-- ä¸ºæ¯ä¸ªå…³èŠ‚åˆ›å»ºç«‹æ–¹ä½“ï¼ˆä¿®å¤ç©ºå¼•ç”¨æŠ¥é”™ï¼‰
local function createJointCubes()
    -- æ¸…ç†æ—§çš„ç«‹æ–¹ä½“ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
    for _, cube in pairs(cubeTable) do
        if cube and cube.Parent then
            cube:Destroy()
        end
    end
    table.clear(cubeTable)

    -- ä¸ºæ¯ä¸ªå­˜åœ¨çš„å…³èŠ‚åˆ›å»ºç«‹æ–¹ä½“
    for _, jointName in ipairs(R15_JOINTS) do
        local joint = character:FindFirstChild(jointName)
        if joint and joint:IsA("BasePart") then
            local cube = Instance.new("Part")
            cube.Name = "Cube_" .. jointName
            cube.Size = CUBE_CONFIG.Size
            cube.Color = CUBE_CONFIG.Colors[math.random(1, #CUBE_CONFIG.Colors)]
            cube.Material = CUBE_CONFIG.Material
            cube.Transparency = CUBE_CONFIG.Transparency
            cube.Anchored = true
            cube.CanCollide = false
            cube.CanQuery = false
            cube.CastShadow = false

            cubeTable[jointName] = cube
            cube.Parent = workspace
        end
    end
    print("âœ… å·²ä¸ºæ£€æµ‹åˆ°çš„å…³èŠ‚åˆ›å»ºç«‹æ–¹ä½“")
end

-- æ›´æ–°æ‰€æœ‰ç«‹æ–¹ä½“ä½ç½®ï¼ˆä¿®å¤è§’è‰²ç©ºå¼•ç”¨ï¼‰
local function updateAllCubes()
    if not character or not character.Parent then return end
    for jointName, cube in pairs(cubeTable) do
        local joint = character:FindFirstChild(jointName)
        if joint and joint:IsA("BasePart") and cube and cube.Parent then
            cube.Position = joint.Position
        end
    end
end

-- ä½¿ç”¨Steppedäº‹ä»¶æ›´æ–°ï¼ŒåŒæ­¥è§’è‰²è¿åŠ¨
RunService.Stepped:Connect(updateAllCubes)

-- è§’è‰²åŠ è½½æ—¶åˆ›å»º
if character and character.Parent then
    task.wait(1)  -- ç­‰å¾…R15æ¨¡å‹å®Œå…¨åŠ è½½
    createJointCubes()
end

-- ç›‘å¬è§’è‰²é‡ç”Ÿï¼Œé‡æ–°åˆ›å»ºç«‹æ–¹ä½“
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    task.wait(1.5)  -- ç­‰å¾…R15å®Œå…¨åŠ è½½
    createJointCubes()
end)

-- ============== æ—¥å¿—è¾“å‡ºï¼ˆç²¾ç®€ï¼Œæ— å†—ä½™ï¼‰ ==============
print("âœ… åŠ¨ä½œå·¥å…·ç®±+R15å…³èŠ‚ç«‹æ–¹ä½“ åŒç³»ç»ŸåŠ è½½å®Œæˆ")
print("ğŸ¬ åŠ¨ä½œåŠŸèƒ½ï¼šç‚¹å‡»æŒ‰é’®æ’­æ”¾ / F1æ˜¾éš / F2æœ€å°åŒ– / F3æ¸…é™¤")
print("ğŸ“Œ ç«‹æ–¹ä½“åŠŸèƒ½ï¼šå®æ—¶è·ŸéšR15å…³èŠ‚ä½ç½®")

-- è¿”å›å·¥å…·ç®±å¼•ç”¨ï¼ˆæŒ‰éœ€ä½¿ç”¨ï¼‰
local ToolboxAPI = {
    Gui = ActionToolbox,
    Window = MainWindow,
    PlayAnimation = playAnimation,
    ClearAllAnimations = clearAllAnimations,
    ToggleVisibility = toggleVisibility,
    ToggleMinimize = toggleMinimize,
    RecreateJointCubes = createJointCubes
}
return ToolboxAPI