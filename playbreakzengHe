-- playbreak脚本中心 v4.3.0 | 作者：渔炒鱼
-- 包含动作、刷物、视角切换等功能，仅支持指定游戏ID

-- 服务器校验（仅在playbreak中运行）
local TARGET_PLACE_ID = 15078849939
if game.PlaceId ~= TARGET_PLACE_ID then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "脚本无法使用",
        Text = "你不在playbreak服务器中",
        Icon = "rbxassetid://18143239786",
        Duration = 5
    })
    return
end

-- 脚本启动音效
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://9042971851"
sound.Volume = 1.0
sound.Parent = workspace
sound:Play()

-- Hook检测（确保脚本安全）
local HttpService = cloneref(game:GetService("HttpService"))
local isfunctionhooked = clonefunction(isfunctionhooked)
if isfunctionhooked(game.HttpGet) or isfunctionhooked(getnamecallmethod) or isfunctionhooked(request) then
    return
end

-- 加载WindUI界面框架
local success, WindUI = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/refs/heads/main/dist/main.lua"))()
end)
if not success then
    warn("WindUI加载失败，脚本无法运行")
    return
end

-- WindUI基础配置
WindUI.TransparencyValue = 0.3
WindUI:SetTheme("Dark")

-- 创建主窗口
local Window = WindUI:CreateWindow({
    Title = "playbreak脚本中心",
    Icon = "crown",
    Author = "渔炒鱼",
    Folder = "playbreak脚本",
    Size = UDim2.fromOffset(550, 650),
    Theme = "Light",
    User = { Enabled = true, Anonymous = false },
    SideBarWidth = 180,
    ScrollBarEnabled = true,
    ShowSectionToggle = false
})

-- 1. 主页Tab
local HomeTab = Window:Tab({ Title = "主页", Icon = "home" })
HomeTab:Section({ Title = "脚本简介", Icon = "info" })
HomeTab:Button({ Title = "playbreak脚本中心", Callback = function() end })
HomeTab:Button({ Title = "此脚本为缝合功能集合", Callback = function() end })
HomeTab:Button({ Title = "使用后果自行承担", Callback = function() end })

HomeTab:Section({ Title = "开发者信息", Icon = "user" })
HomeTab:Button({ Title = "开发者：渔炒鱼", Callback = function() end })
HomeTab:Button({ Title = "致谢：XQ-HANHUA", Callback = function() end })
HomeTab:Image({
    Image = "rbxassetid://111333374680640",
    Size = UDim2.fromOffset(250, 250),
    CornerRadius = 8
})

HomeTab:Section({ Title = "系统状态", Icon = "server" })
HomeTab:Button({ Title = "版本: v4.3.0", Callback = function() end })

-- 2. 动作Tab
local ActionTab = Window:Tab({ Title = "动作", Icon = "dancing" })
ActionTab:Section({ Title = "动作功能集合", Icon = "music" })
ActionTab:Button({
    Title = "R15动作脚本（汉化）",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载R15动作脚本...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))() end)
    end
})
ActionTab:Button({
    Title = "playbreak动作包",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载动作包...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreakAction"))() end)
    end
})
ActionTab:Button({
    Title = "基础动作脚本",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载基础动作...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Boxten-Keyes/music/refs/heads/main/music%23%5Bscripts%5D/music%23%5Bmiscellaneous%5D/music%23%5Bfe%20r15%20animation%20player%5D.lua", true))() end)
    end
})

-- 3. 刷物Tab
local BrushItemTab = Window:Tab({ Title = "刷物", Icon = "gift" })
BrushItemTab:Section({ Title = "刷物功能", Icon = "shopping-bag" })
BrushItemTab:Button({
    Title = "启用刷票功能",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载刷票...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))() end)
    end
})
BrushItemTab:Button({
    Title = "启用刷经验功能",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载刷经验...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))() end)
    end
})

-- 4. 视角Tab（第三人称控制）
local CameraTab = Window:Tab({ Title = "视角", Icon = "eye" })
CameraTab:Section({ Title = "第三人称设置", Icon = "camera" })
local ThirdPersonManager = { Enabled = false, Connections = {}, OriginalSettings = {} }

-- 等待玩家/相机加载
local function waitForPlayerAndCamera()
    local player = game.Players.LocalPlayer
    while not player or not player.Character do task.wait(0.1) end
    local camera = workspace.CurrentCamera
    while not camera do task.wait(0.1) end
    return player, camera
end

-- 保存原始相机设置
local function saveOriginalSettings()
    local player, camera = waitForPlayerAndCamera()
    ThirdPersonManager.OriginalSettings = {
        CameraMinZoomDistance = player.CameraMinZoomDistance,
        CameraMaxZoomDistance = player.CameraMaxZoomDistance,
        CameraMode = player.CameraMode,
        CameraType = camera.CameraType
    }
end

-- 启用第三人称
local function enableThirdPerson()
    if ThirdPersonManager.Enabled then return end
    local player, camera = waitForPlayerAndCamera()
    saveOriginalSettings()
    player.CameraMinZoomDistance = 8
    player.CameraMaxZoomDistance = 20
    player.CameraMode = Enum.CameraMode.Classic
    camera.CameraType = Enum.CameraType.Follow
    local renderConnection = game:GetService("RunService").RenderStepped:Connect(function()
        if camera.CameraType ~= Enum.CameraType.Follow then camera.CameraType = Enum.CameraType.Follow end
        if player.Character and player.Character.HumanoidRootPart then camera.Focus = player.Character.HumanoidRootPart.CFrame end
    end)
    table.insert(ThirdPersonManager.Connections, renderConnection)
    ThirdPersonManager.Enabled = true
    WindUI:Notify({ Title = "视角切换", Content = "已启用第三人称", Duration = 2 })
end

-- 禁用第三人称
local function disableThirdPerson()
    if not ThirdPersonManager.Enabled then return end
    for _, connection in ipairs(ThirdPersonManager.Connections) do if connection then connection:Disconnect() end end
    ThirdPersonManager.Connections = {}
    local player, camera = waitForPlayerAndCamera()
    if ThirdPersonManager.OriginalSettings then
        player.CameraMinZoomDistance = ThirdPersonManager.OriginalSettings.CameraMinZoomDistance or 0.5
        player.CameraMaxZoomDistance = ThirdPersonManager.OriginalSettings.CameraMaxZoomDistance or 400
        player.CameraMode = ThirdPersonManager.OriginalSettings.CameraMode or Enum.CameraMode.Classic
        camera.CameraType = ThirdPersonManager.OriginalSettings.CameraType or Enum.CameraType.Custom
    end
    ThirdPersonManager.Enabled = false
    WindUI:Notify({ Title = "视角切换", Content = "已禁用第三人称", Duration = 2 })
end

CameraTab:Button({
    Title = "第三人称 切换开关",
    Callback = function() if not ThirdPersonManager.Enabled then enableThirdPerson() else disableThirdPerson() end end
})
CameraTab:Button({ Title = "启用强制第三人称", Callback = function() pcall(enableThirdPerson) end })
CameraTab:Button({ Title = "禁用第三人称", Callback = function() pcall(disableThirdPerson) end })

-- 5. 其他Tab
local OtherTab = Window:Tab({ Title = "其他", Icon = "more-horizontal" })
OtherTab:Section({ Title = "辅助功能", Icon = "wrench" })
OtherTab:Button({
    Title = "最强脚本",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载主脚本...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreakawa", true))() end)
    end
})
OtherTab:Button({
    Title = "运行连跳脚本",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载连跳...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))() end)
    end
})
OtherTab:Button({
    Title = "老版本ui",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载整合脚本...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreakzeng", true))() end)
    end
})
OtherTab:Button({
    Title = "启动炸麦脚步",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载炸麦脚步...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet([[https://raw.githubusercontent.com/0Ben1/fe/main/obf_rf6iQURzu1fqrytcnLBAvW34C9N55kS9g9G3CKz086rC47M6632sEd4ZZYB0AYgV.lua.txt]]))() end)
    end
})
OtherTab:Button({
    Title = "加载playbreak材质包",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载材质包...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreak.ogg"))() end)
    end
})
OtherTab:Button({
    Title = "启用KENNY自动汉化",
    Callback = function()
        WindUI:Notify({ Title = "加载中", Content = "正在加载自动汉化...", Duration = 3 })
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/KENNY自动汉化.txt"))() end)
    end
})

-- 6. 设置Tab
local SettingsTab = Window:Tab({ Title = "设置", Icon = "settings" })
SettingsTab:Section({ Title = "界面控制", Icon = "sliders" })
SettingsTab:Button({
    Title = "关闭界面",
    Icon = "x-circle",
    Callback = function()
        for _, connection in ipairs(ThirdPersonManager.Connections) do if connection then connection:Disconnect() end end
        Window:Destroy()
        if sound then sound:Destroy() end
    end
})
SettingsTab:Button({
    Title = "重新加载脚本",
    Icon = "refresh-cw",
    Callback = function()
        Window:Destroy()
        if sound then sound:Destroy() end
        task.wait(1)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/playbreak"))() end)
    end
})
SettingsTab:Section({ Title = "批量操作", Icon = "cubes" })
SettingsTab:Button({
    Title = "加载所有功能",
    Icon = "download",
    Callback = function()
        WindUI:Notify({ Title = "批量加载", Content = "开始加载所有功能...", Duration = 3 })
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))() end)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))() end)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))() end)
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreak.ogg"))() end)
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreakAction"))() end)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))() end)
        task.wait(0.5)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/KENNY自动汉化.txt"))() end)
        WindUI:Notify({ Title = "批量加载", Content = "所有功能已加载完成！", Duration = 5 })
    end
})

-- 欢迎提示
task.wait(0.1)
WindUI:Notify({
    Title = "playbreak脚本中心",
    Content = "欢迎使用v4.3.0",
    Duration = 5
})

-- 默认选中主页
Window:SelectTab(HomeTab)