-- 使用稳定可靠的UI库
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- 创建窗口 - 使用完整的配置
local Window = Rayfield:CreateWindow({
    Name = "playbreak脚本中心",
    LoadingTitle = "playbreak脚本中心",
    LoadingSubtitle = "BY-渔炒鱼",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "playbreak_config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "playbreak",
        Subtitle = "Key System",
        Note = "No key required",
        FileName = "playbreakKey",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {"playbreak"}
    }
})

-- 等待窗口初始化
wait(0.2)

-- 创建主标签页
local MainTab = Window:CreateTab("主页", 98446998103932)
local MainSection = MainTab:CreateSection("脚本简介")
MainTab:CreateLabel("playbreak脚本中心")
MainTab:CreateLabel("此脚本为缝合 少数功能为源代码 多数功能为自创")
MainTab:CreateLabel("使用后果自行承担")

local StatusSection = MainTab:CreateSection("系统状态")
MainTab:CreateLabel("版本: v2.0.0")
MainTab:CreateLabel("状态: 已就绪")
MainTab:CreateLabel("功能模块: 5个")

-- 创建刷物标签页
local VoteTab = Window:CreateTab("刷物", 98446998103932)
local VoteSection = VoteTab:CreateSection("刷票+刷经验")

VoteTab:CreateButton({
    Name = "启用刷票功能",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))()
        end)
    end,
})

VoteTab:CreateButton({
    Name = "启用刷经验功能",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))()
        end)
    end,
})

local VoteInfoSection = VoteTab:CreateSection("功能说明")
VoteTab:CreateLabel("刷票功能：仅兼容此游戏")
VoteTab:CreateLabel("刷经验功能：仅兼容此游戏")
VoteTab:CreateLabel("请确保在正确的游戏中使用")

-- 创建视角功能标签页
local CameraTab = Window:CreateTab("视角功能", 98446998103932)
local CameraSection = CameraTab:CreateSection("第三人称设置")

-- 第三人称状态管理
local ThirdPersonManager = {
    Enabled = false,
    Connections = {},
    OriginalSettings = {}
}

-- 保存原始设置
local function saveOriginalSettings()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    
    ThirdPersonManager.OriginalSettings = {
        CameraMinZoomDistance = player.CameraMinZoomDistance,
        CameraMaxZoomDistance = player.CameraMaxZoomDistance,
        CameraMode = player.CameraMode,
        CameraType = workspace.CurrentCamera.CameraType
    }
end

-- 启用强制第三人称
local function enableThirdPerson()
    if ThirdPersonManager.Enabled then return end
    
    saveOriginalSettings()
    
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    
    -- 设置相机参数
    player.CameraMinZoomDistance = 5   -- 最小缩放距离
    player.CameraMaxZoomDistance = 50  -- 最大缩放距离
    player.CameraMode = Enum.CameraMode.Classic
    
    -- 强制设置为跟随模式
    camera.CameraType = Enum.CameraType.Follow
    
    -- 定期检查并强制保持第三人称
    local heartbeatConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if camera.CameraType ~= Enum.CameraType.Follow then
            camera.CameraType = Enum.CameraType.Follow
        end
    end)
    
    table.insert(ThirdPersonManager.Connections, heartbeatConnection)
    ThirdPersonManager.Enabled = true
end

-- 启用增强版第三人称
local function enableEnhancedThirdPerson()
    if ThirdPersonManager.Enabled then
        disableThirdPerson()
    end
    
    saveOriginalSettings()
    
    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local RunService = game:GetService("RunService")
    
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    
    -- 相机参数
    local cameraDistance = 10
    local minDistance = 4
    local maxDistance = 20
    
    -- 设置相机为脚本控制
    camera.CameraType = Enum.CameraType.Scriptable
    
    -- 鼠标滚轮缩放
    local zoomConnection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseWheel then
            cameraDistance = math.clamp(cameraDistance - input.Position.Z * 0.5, minDistance, maxDistance)
        end
    end)
    
    -- 更新相机位置
    local renderConnection = RunService.RenderStepped:Connect(function()
        if not player.Character then return end
        
        local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
        local head = player.Character:FindFirstChild("Head")
        
        if humanoidRootPart and head then
            -- 计算相机位置（在角色后方）
            local offset = Vector3.new(0, 3, cameraDistance)
            local cameraPosition = humanoidRootPart.Position + 
                                 (humanoidRootPart.CFrame:VectorToWorldSpace(offset))
            
            -- 设置相机
            camera.CFrame = CFrame.new(cameraPosition, head.Position)
        end
    end)
    
    -- 保存连接
    table.insert(ThirdPersonManager.Connections, zoomConnection)
    table.insert(ThirdPersonManager.Connections, renderConnection)
    ThirdPersonManager.Enabled = true
end

-- 禁用第三人称
local function disableThirdPerson()
    if not ThirdPersonManager.Enabled then return end
    
    -- 断开所有连接
    for _, connection in ipairs(ThirdPersonManager.Connections) do
        if connection then
            connection:Disconnect()
        end
    end
    
    ThirdPersonManager.Connections = {}
    
    -- 恢复原始设置
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    
    if ThirdPersonManager.OriginalSettings then
        player.CameraMinZoomDistance = ThirdPersonManager.OriginalSettings.CameraMinZoomDistance or 0.5
        player.CameraMaxZoomDistance = ThirdPersonManager.OriginalSettings.CameraMaxZoomDistance or 400
        player.CameraMode = ThirdPersonManager.OriginalSettings.CameraMode or Enum.CameraMode.Classic
        camera.CameraType = ThirdPersonManager.OriginalSettings.CameraType or Enum.CameraType.Custom
    end
    
    ThirdPersonManager.Enabled = false
end

-- 第三人称开关按钮
CameraTab:CreateToggle({
    Name = "第三人称开关",
    CurrentValue = false,
    Flag = "ThirdPersonToggle",
    Callback = function(value)
        if value then
            enableThirdPerson()
        else
            disableThirdPerson()
        end
    end,
})

-- 启用强制第三人称按钮
CameraTab:CreateButton({
    Name = "启用强制第三人称",
    Callback = function()
        pcall(function()
            enableThirdPerson()
        end)
    end,
})

-- 启用增强版第三人称按钮
CameraTab:CreateButton({
    Name = "启用奇怪的第三人称",
    Callback = function()
        pcall(function()
            enableEnhancedThirdPerson()
        end)
    end,
})

-- 禁用第三人称按钮
CameraTab:CreateButton({
    Name = "禁用第三人称",
    Callback = function()
        pcall(function()
            disableThirdPerson()
        end)
    end,
})

local CameraInfoSection = CameraTab:CreateSection("功能说明")
CameraTab:CreateLabel("第三人称开关：切换基础视角")
CameraTab:CreateLabel("强制第三人称：锁定跟随模式")
CameraTab:CreateLabel("奇怪第三人称：自定义视角系统")
CameraTab:CreateLabel("使用鼠标滚轮调整距离")

-- 创建连跳功能标签页
local JumpTab = Window:CreateTab("连跳功能", 98446998103932)
local JumpSection = JumpTab:CreateSection("自动连跳系统")

JumpTab:CreateButton({
    Name = "运行连跳脚本",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))()
        end)
    end,
})

local JumpInfoSection = JumpTab:CreateSection("功能说明")
JumpTab:CreateLabel("自动连续跳跃功能")
JumpTab:CreateLabel("无需手动按键操作")
JumpTab:CreateLabel("降低速度衰减")

-- 创建动作功能标签页
local ActionTab = Window:CreateTab("动作功能", 98446998103932)
local ActionSection = ActionTab:CreateSection("R15动作脚本")

ActionTab:CreateButton({
    Name = "R15动作脚本（汉化）",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))()
        end)
    end,
})

local ActionInfoSection = ActionTab:CreateSection("功能说明")
ActionTab:CreateLabel("汉化多种功能（不完全）")
ActionTab:CreateLabel("支持R15角色模型")
ActionTab:CreateLabel("多种预设动作可用")
ActionTab:CreateLabel("部分功能已汉化")

-- 创建设置标签页
local SettingsTab = Window:CreateTab("设置", 98446998103932)
local SettingsSection = SettingsTab:CreateSection("界面设置")

SettingsTab:CreateButton({
    Name = "关闭界面",
    Callback = function()
        Rayfield:Destroy()
    end,
})

SettingsTab:CreateButton({
    Name = "重新加载脚本",
    Callback = function()
        Rayfield:Destroy()
        wait(1)
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/playbreak"))()
    end,
})

local BatchSection = SettingsTab:CreateSection("批量操作")

SettingsTab:CreateButton({
    Name = "加载所有脚本",
    Callback = function()
        -- 加载所有脚本
        pcall(function() 
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))() 
        end)
        
        pcall(function() 
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))() 
        end)
        
        pcall(function() 
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))() 
        end)
        
        pcall(function() 
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))() 
        end)
    end,
})

local AboutSection = SettingsTab:CreateSection("关于")
SettingsTab:CreateLabel("开发者：渔炒鱼")
SettingsTab:CreateLabel("版本：4.0.0")
SettingsTab:CreateLabel("此脚本完全免费")

-- 等待所有元素加载
wait(0.1)

print("=========================================")
print("playbreak脚本中心 - 加载完成")
print("所有标签页使用图标ID: 98446998103932")
print("功能模块：")
print("  1. 主页 - 系统信息")
print("  2. 刷物 - 刷票+刷经验（仅兼容此游戏）")
print("  3. 视角功能 - 第三人称系统")
print("  4. 连跳功能 - 自动连跳")
print("  5. 动作功能 - R15动作（汉化多种功能）")
print("  6. 设置 - 界面控制")
print("=========================================")