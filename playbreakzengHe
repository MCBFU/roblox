-- 极简音频播放
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://9042971851"
sound.Volume = 1.0
sound.Parent = workspace
sound:Play()
-- 使用稳定可靠的UI库
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- 创建窗口 - 修复配置报错，正常启动
local Window = Rayfield:CreateWindow({
    Name = "playbreak脚本中心",
    LoadingTitle = "playbreak脚本中心",
    LoadingSubtitle = "BY-渔炒鱼",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "playbreak_config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "playbreak",
        Subtitle = "Key System",
        Note = "No key required",
        FileName = "playbreakKey",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {"playbreak"}
    }
})

-- 等待窗口初始化
wait(0.2)

-- 创建主标签页
local MainTab = Window:CreateTab("主页", 98446998103932)
local MainSection = MainTab:CreateSection("脚本简介")
MainTab:CreateLabel("playbreak脚本中心")
MainTab:CreateLabel("此脚本为缝合 少数功能为源代码 多数功能为自创")
MainTab:CreateLabel("使用后果自行承担")

local StatusSection = MainTab:CreateSection("系统状态")
MainTab:CreateLabel("版本: v2.0.0")
MainTab:CreateLabel("状态: 已就绪")
MainTab:CreateLabel("功能模块: 6个")

-- 创建刷物标签页
local VoteTab = Window:CreateTab("刷物", 98446998103932)
local VoteSection = VoteTab:CreateSection("刷票+刷经验")

VoteTab:CreateButton({
    Name = "启用刷票功能",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))()
        end)
    end,
})

VoteTab:CreateButton({
    Name = "启用刷经验功能",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))()
        end)
    end,
})

local VoteInfoSection = VoteTab:CreateSection("功能说明")
VoteTab:CreateLabel("刷票功能：仅兼容此游戏")
VoteTab:CreateLabel("刷经验功能：仅兼容此游戏")
VoteTab:CreateLabel("请确保在正确的游戏请确保在正确的游戏中使用")

-- 创建视角功能标签页 | 修复核心报错，保证正常启动
local CameraTab = Window:CreateTab("视角功能", 98446998103932)
local CameraSection = CameraTab:CreateSection("第三人称设置")

local ThirdPersonManager = {
    Enabled = false,
    Connections = {},
    OriginalSettings = {}
}

local function saveOriginalSettings()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    ThirdPersonManager.OriginalSettings = {
        CameraMinZoomDistance = player.CameraMinZoomDistance,
        CameraMaxZoomDistance = player.CameraMaxZoomDistance,
        CameraMode = player.CameraMode,
        CameraType = camera.CameraType
    }
end

local function enableThirdPerson()
    if ThirdPersonManager.Enabled then return end
    saveOriginalSettings()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    player.CameraMinZoomDistance = 5
    player.CameraMaxZoomDistance = 50
    player.CameraMode = Enum.CameraMode.Classic
    camera.CameraType = Enum.CameraType.Follow
    local heartbeatConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if camera.CameraType ~= Enum.CameraType.Follow then
            camera.CameraType = Enum.CameraType.Follow
        end
    end)
    table.insert(ThirdPersonManager.Connections, heartbeatConnection)
    ThirdPersonManager.Enabled = true
end

local function enableEnhancedThirdPerson()
    if ThirdPersonManager.Enabled then disableThirdPerson() end
    saveOriginalSettings()
    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local RunService = game:GetService("RunService")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    local cameraDistance = 10
    local minDistance = 4
    local maxDistance = 20
    camera.CameraType = Enum.CameraType.Scriptable
    local zoomConnection = UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseWheel then
            cameraDistance = math.clamp(cameraDistance - input.Position.Z * 0.5, minDistance, maxDistance)
        end
    end)
    local renderConnection = RunService.RenderStepped:Connect(function()
        if not player.Character then return end
        local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
        local head = player.Character:FindFirstChild("Head")
        if humanoidRootPart and head then
            local offset = Vector3.new(0, 3, cameraDistance)
            local cameraPosition = humanoidRootPart.Position + (humanoidRootPart.CFrame:VectorToWorldSpace(offset))
            camera.CFrame = CFrame.new(cameraPosition, head.Position)
        end
    end)
    table.insert(ThirdPersonManager.Connections, zoomConnection)
    table.insert(ThirdPersonManager.Connections, renderConnection)
    ThirdPersonManager.Enabled = true
end

local function disableThirdPerson()
    if not ThirdPersonManager.Enabled then return end
    for _, connection in ipairs(ThirdPersonManager.Connections) do
        if connection then connection:Disconnect() end
    end
    ThirdPersonManager.Connections = {}
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local camera = workspace.CurrentCamera
    if ThirdPersonManager.OriginalSettings then
        player.CameraMinZoomDistance = ThirdPersonManager.OriginalSettings.CameraMinZoomDistance or 0.5
        player.CameraMaxZoomDistance = ThirdPersonManager.OriginalSettings.CameraMaxZoomDistance or 400
        player.CameraMode = ThirdPersonManager.OriginalSettings.CameraMode or Enum.CameraMode.Classic
        camera.CameraType = ThirdPersonManager.OriginalSettings.CameraType or Enum.CameraType.Custom
    end
    ThirdPersonManager.Enabled = false
end

CameraTab:CreateToggle({
    Name = "第三人称开关",
    CurrentValue = false,
    Flag = "ThirdPersonToggle",
    Callback = function(value)
        if value then enableThirdPerson() else disableThirdPerson() end
    end,
})

CameraTab:CreateButton({ Name = "启用强制第三人称", Callback = function() pcall(enableThirdPerson) end, })
CameraTab:CreateButton({ Name = "启用奇怪的第三人称", Callback = function() pcall(enableEnhancedThirdPerson) end, })
CameraTab:CreateButton({ Name = "禁用第三人称", Callback = function() pcall(disableThirdPerson) end, })

local CameraInfoSection = CameraTab:CreateSection("功能说明")
CameraTab:CreateLabel("第三人称开关：切换基础视角")
CameraTab:CreateLabel("强制第三人称：锁定跟随模式")
CameraTab:CreateLabel("奇怪第三人称：自定义视角系统")
CameraTab:CreateLabel("使用鼠标滚轮调整距离")

-- 材质包标签页 | 删掉无用函数+残留，无链接泄露
local MaterialTab = Window:CreateTab("材质包", 98446998103932)
local MaterialSection = MaterialTab:CreateSection("playbreak材质包")
local MaterialManager = { Enabled = false, Status = "未加载" }

local function loadMaterialPack()
    if MaterialManager.Enabled then
        Rayfield:Notify({ Title = "材质包", Content = "材质包已在运行中", Duration = 3, Image = 98446998103932 })
        return
    end
    Rayfield:Notify({ Title = "材质包", Content = "正在加载playbreak材质包...", Duration = 3, Image = 98446998103932 })
    local success, result = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreak.ogg"))()
    end)
    if success then
        MaterialManager.Enabled = true
        MaterialManager.Status = "已加载"
        Rayfield:Notify({ Title = "材质包", Content = "playbreak材质包已成功加载！", Duration = 5, Image = 98446998103932 })
    else
        MaterialManager.Status = "加载失败"
        Rayfield:Notify({ Title = "材质包", Content = "材质包加载失败", Duration = 5, Image = 98446998103932 })
    end
end

MaterialTab:CreateButton({ Name = "加载playbreak材质包", Callback = loadMaterialPack, })
local MaterialInfoSection = MaterialTab:CreateSection("材质包功能说明")
MaterialTab:CreateLabel("playbreak专属材质包")
MaterialTab:CreateLabel("包含高清纹理和特效")
MaterialTab:CreateLabel("提升游戏视觉体验")
MaterialTab:CreateLabel("可能会影响性能")

MaterialTab:CreateButton({
    Name = "预览材质效果",
    Callback = function()
        Rayfield:Notify({ Title = "材质预览", Content = "正在显示材质包效果预览", Duration = 3, Image = 98446998103932 })
    end,
})
MaterialTab:CreateButton({ Name = "重新加载材质包", Callback = function() pcall(loadMaterialPack) end, })

-- 汉化功能标签页 | 隐藏报错详情，无链接泄露
local LocalizationTab = Window:CreateTab("汉化功能", 98446998103932)
local LocalizationSection = LocalizationTab:CreateSection("KENNY自动汉化系统")
local LocalizationManager = { Enabled = false, CurrentLanguage = "简体中文", Status = "待启用" }

local function enableKennyChineseLocalization()
    if LocalizationManager.Enabled then
        Rayfield:Notify({ Title = "汉化系统", Content = "汉化功能已在运行中", Duration = 3, Image = 98446998103932 })
        return
    end
    Rayfield:Notify({ Title = "汉化系统", Content = "正在加载KENNY自动汉化...", Duration = 3, Image = 98446998103932 })
    local success = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/KENNY自动汉化.txt"))()
    end)
    if success then
        LocalizationManager.Enabled = true
        LocalizationManager.Status = "已启用"
        Rayfield:Notify({ Title = "汉化系统", Content = "KENNY自动汉化已成功加载！", Duration = 5, Image = 98446998103932 })
    else
        LocalizationManager.Status = "加载失败"
        Rayfield:Notify({ Title = "汉化系统", Content = "汉化功能加载失败", Duration = 5, Image = 98446998103932 })
    end
end

LocalizationTab:CreateLabel("当前状态: 待启用")
LocalizationTab:CreateLabel("目标语言: 简体中文")
LocalizationTab:CreateButton({ Name = "启用KENNY自动汉化", Callback = enableKennyChineseLocalization, })

local LocalizationInfoSection = LocalizationTab:CreateSection("汉化功能说明")
LocalizationTab:CreateLabel("此脚本为缝合")
LocalizationTab:CreateLabel("- 可能会掉帧")
LocalizationTab:CreateLabel("- 并非原创")
LocalizationTab:CreateLabel("- 未经授权")
LocalizationTab:CreateLabel("- 侵权立马删")

LocalizationTab:CreateButton({
    Name = "测试汉化效果",
    Callback = function()
        Rayfield:Notify({ Title = "汉化测试", Content = "这是一个汉化功能测试消息", Duration = 3, Image = 98446998103932 })
    end,
})
LocalizationTab:CreateButton({ Name = "重新加载汉化", Callback = enableKennyChineseLocalization, })

-- 连跳功能标签页
local JumpTab = Window:CreateTab("连跳功能", 98446998103932)
local JumpSection = JumpTab:CreateSection("自动连跳系统")
JumpTab:CreateButton({
    Name = "运行连跳脚本",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))()
        end)
    end,
})
local JumpInfoSection = JumpTab:CreateSection("功能说明")
JumpTab:CreateLabel("自动连续跳跃功能")
JumpTab:CreateLabel("无需手动按键操作")
JumpTab:CreateLabel("降低速度衰减")

-- 动作合集标签页 | 删掉状态显示，无泄露
local ActionTab = Window:CreateTab("动作合集", 98446998103932)
local ActionSection = ActionTab:CreateSection("动作功能集合")
local ActionPackManager = { Enabled = false }

local function loadPlaybreakActionPack()
    if ActionPackManager.Enabled then
        Rayfield:Notify({ Title = "动作包", Content = "playbreak动作包已在运行中", Duration = 3, Image = 98446998103932 })
        return
    end
    Rayfield:Notify({ Title = "动作包", Content = "正在加载playbreak动作包...", Duration = 3, Image = 98446998103932 })
    local success = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBFU/roblox/refs/heads/main/playbreakAction"))()
    end)
    if success then
        ActionPackManager.Enabled = true
        Rayfield:Notify({ Title = "动作包", Content = "playbreak动作包已成功加载！", Duration = 5, Image = 98446998103932 })
    else
        Rayfield:Notify({ Title = "动作包", Content = "动作包加载失败", Duration = 5, Image = 98446998103932 })
    end
end

ActionTab:CreateButton({ Name = "playbreak动作包", Callback = loadPlaybreakActionPack, })
ActionTab:CreateButton({
    Name = "R15动作脚本（汉化）",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))()
        end)
    end,
})
local ActionInfoSection = ActionTab:CreateSection("功能说明")
ActionTab:CreateLabel("playbreak动作包：专属动作集合")
ActionTab:CreateLabel("R15动作脚本：汉化多种功能")
ActionTab:CreateLabel("支持多种预设动作")
ActionTab:CreateLabel("可能会与其他脚本冲突")
ActionTab:CreateButton({
    Name = "测试动作效果",
    Callback = function()
        Rayfield:Notify({ Title = "动作测试", Content = "正在测试动作功能", Duration = 3, Image = 98446998103932 })
    end,
})

-- 设置标签页 | 修复重新加载报错，无输出
local SettingsTab = Window:CreateTab("设置", 98446998103932)
local SettingsSection = SettingsTab:CreateSection("界面设置")
SettingsTab:CreateButton({ Name = "关闭界面", Callback = function() Rayfield:Destroy() end, })
SettingsTab:CreateButton({
    Name = "重新加载脚本",
    Callback = function()
        Rayfield:Destroy()
        wait(1)
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/playbreak"))()
        end)
    end,
})

local BatchSection = SettingsTab:CreateSection("批量操作")
SettingsTab:CreateButton({
    Name = "加载所有功能",
    Callback = function()
        Rayfield:Notify({ Title = "批量加载", Content = "开始加载所有功能模块...", Duration = 3, Image = 98446998103932 })
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/ShuaPiao"))() end)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/Qaq"))() end)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/LianTiao"))() end)
        wait(0.5)
        pcall(loadMaterialPack)
        wait(0.5)
        pcall(loadPlaybreakActionPack)
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MCBfun/roblox/refs/heads/main/r15ChineseLanguage"))() end)
        wait(0.5)
        pcall(enableKennyChineseLocalization)
        Rayfield:Notify({ Title = "批量加载", Content = "所有功能模块已加载完成！", Duration = 5, Image = 98446998103932 })
    end,
})

local AboutSection = SettingsTab:CreateSection("关于")
SettingsTab:CreateLabel("开发者：渔炒鱼")
SettingsTab:CreateLabel("版本：4.2.0")
SettingsTab:CreateLabel("新增功能：材质包系统")
SettingsTab:CreateLabel("此脚本完全免费")

-- 欢迎提示，无多余输出
wait(0.1)
Rayfield:Notify({ Title = "playbreak脚本中心", Content = "欢迎使用playbreak v4.2.0", Duration = 5, Image = 98446998103932 })