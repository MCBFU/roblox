-- ================================
-- 紧凑版高级验证系统 v3.4 - 小型自定义图片版
-- 作者：渔妙鱼 | B站：作者B站？
-- ================================

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")

-- 确保玩家存在
repeat RunService.Heartbeat:Wait() until Players.LocalPlayer
local Player = Players.LocalPlayer
local Gui = Player:WaitForChild("PlayerGui")

-- 创建景深模糊效果
local DepthOfField = Instance.new("DepthOfFieldEffect")
DepthOfField.FarIntensity = 0
DepthOfField.NearIntensity = 0
DepthOfField.InFocusRadius = 0
DepthOfField.Parent = Lighting

-- ================================
-- 小型紧凑UI创建
-- ================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SmallAuthSystem"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = false

-- 小型主容器（更小更居中）
local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(0, 260, 0, 320)  -- 更小的尺寸
MainContainer.Position = UDim2.new(0.5, -130, 0.5, -160)  -- 更居中
MainContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
MainContainer.BackgroundTransparency = 0.1
MainContainer.BorderSizePixel = 0
MainContainer.ClipsDescendants = true
MainContainer.Parent = ScreenGui

-- 添加圆角
local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainContainer

-- 添加玻璃态效果
local GlassEffect = Instance.new("Frame")
GlassEffect.Size = UDim2.new(1, 0, 1, 0)
GlassEffect.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
GlassEffect.BackgroundTransparency = 0.96
GlassEffect.BorderSizePixel = 0
GlassEffect.ZIndex = 0
GlassEffect.Parent = MainContainer

-- 简洁顶部条
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 2)  -- 更细
TopBar.Position = UDim2.new(0, 0, 0, 0)
TopBar.BackgroundColor3 = Color3.fromRGB(0, 150, 220)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainContainer

-- 标题区域（更紧凑）
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 80)  -- 更矮
Header.Position = UDim2.new(0, 0, 0, 5)
Header.BackgroundTransparency = 1
Header.Parent = MainContainer

-- 小型自定义图片徽标
local CustomLogo = Instance.new("Frame")
CustomLogo.Size = UDim2.new(0, 50, 0, 50)  -- 更小的图片尺寸
CustomLogo.Position = UDim2.new(0.5, -25, 0, 0)
CustomLogo.BackgroundTransparency = 1
CustomLogo.Parent = Header

-- 小型图片容器
local LogoImage = Instance.new("ImageLabel")
LogoImage.Size = UDim2.new(1, 0, 1, 0)
LogoImage.BackgroundTransparency = 1
LogoImage.Image = "rbxassetid://98446998103932"  -- 你的自定义图片ID
LogoImage.ScaleType = Enum.ScaleType.Fit
LogoImage.ImageColor3 = Color3.fromRGB(255, 255, 255)
LogoImage.Parent = CustomLogo

-- 添加圆角
local ImageCorner = Instance.new("UICorner")
ImageCorner.CornerRadius = UDim.new(0, 8)
ImageCorner.Parent = LogoImage

-- 添加发光边框
local ImageStroke = Instance.new("UIStroke")
ImageStroke.Color = Color3.fromRGB(0, 180, 255)
ImageStroke.Thickness = 1.5  -- 更细的边框
ImageStroke.Transparency = 0.5
ImageStroke.Parent = LogoImage

-- 标题（字体稍小）
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 22)
Title.Position = UDim2.new(0, 0, 0.7, 0)
Title.BackgroundTransparency = 1
Title.Text = "验证系统"
Title.TextColor3 = Color3.fromRGB(240, 240, 255)
Title.TextSize = 18  -- 更小的字体
Title.Font = Enum.Font.GothamBold
Title.TextStrokeColor3 = Color3.fromRGB(0, 50, 100)
Title.TextStrokeTransparency = 0.8
Title.Parent = Header

local Author = Instance.new("TextLabel")
Author.Size = UDim2.new(1, 0, 0, 16)
Author.Position = UDim2.new(0, 0, 0.95, 0)
Author.BackgroundTransparency = 1
Author.Text = "作者B站？"
Author.TextColor3 = Color3.fromRGB(170, 180, 200)
Author.TextSize = 10  -- 更小的字体
Author.Font = Enum.Font.Gotham
Author.Parent = Header

-- 输入区域（更紧凑）
local InputSection = Instance.new("Frame")
InputSection.Size = UDim2.new(0.85, 0, 0, 48)  -- 更矮
InputSection.Position = UDim2.new(0.075, 0, 0.32, 0)
InputSection.BackgroundTransparency = 1
InputSection.Parent = MainContainer

local InputBox = Instance.new("Frame")
InputBox.Size = UDim2.new(1, 0, 1, 0)
InputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
InputBox.BackgroundTransparency = 0.1
InputBox.Parent = InputSection

local InputBoxCorner = Instance.new("UICorner")
InputBoxCorner.CornerRadius = UDim.new(0, 6)
InputBoxCorner.Parent = InputBox

local InputBoxStroke = Instance.new("UIStroke")
InputBoxStroke.Color = Color3.fromRGB(50, 60, 80)
InputBoxStroke.Thickness = 1
InputBoxStroke.Parent = InputBox

local KeyInput = Instance.new("TextBox")
KeyInput.Size = UDim2.new(0.9, 0, 0.8, 0)
KeyInput.Position = UDim2.new(0.05, 0, 0.1, 0)
KeyInput.BackgroundTransparency = 1
KeyInput.PlaceholderText = "输入验证密钥..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(120, 130, 150)
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(240, 240, 255)
KeyInput.TextSize = 14  -- 更小的字体
KeyInput.Font = Enum.Font.GothamMedium
KeyInput.ClearTextOnFocus = false
KeyInput.Parent = InputBox

local InputLine = Instance.new("Frame")
InputLine.Size = UDim2.new(0, 0, 0, 2)
InputLine.Position = UDim2.new(0, 0, 1, -2)
InputLine.BackgroundColor3 = Color3.fromRGB(0, 150, 220)
InputLine.BorderSizePixel = 0
InputLine.Parent = InputBox

-- 验证按钮（更小）
local VerifyButton = Instance.new("TextButton")
VerifyButton.Size = UDim2.new(0.7, 0, 0, 40)  -- 更矮
VerifyButton.Position = UDim2.new(0.15, 0, 0.52, 0)
VerifyButton.BackgroundColor3 = Color3.fromRGB(0, 130, 210)
VerifyButton.AutoButtonColor = false
VerifyButton.Text = ""
VerifyButton.Parent = MainContainer

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 8)
ButtonCorner.Parent = VerifyButton

local ButtonGradient = Instance.new("UIGradient")
ButtonGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 130, 210)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 150, 230)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 130, 210))
})
ButtonGradient.Rotation = 90
ButtonGradient.Parent = VerifyButton

local ButtonLabel = Instance.new("TextLabel")
ButtonLabel.Size = UDim2.new(1, 0, 1, 0)
ButtonLabel.BackgroundTransparency = 1
ButtonLabel.Text = "验证并启动"
ButtonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ButtonLabel.TextSize = 15  -- 更小的字体
ButtonLabel.Font = Enum.Font.GothamBold
ButtonLabel.Parent = VerifyButton

local ButtonIcon = Instance.new("TextLabel")
ButtonIcon.Size = UDim2.new(0, 18, 0, 18)  -- 更小
ButtonIcon.Position = UDim2.new(1, -22, 0.5, -9)  -- 调整位置
ButtonIcon.BackgroundTransparency = 1
ButtonIcon.Text = "→"
ButtonIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
ButtonIcon.TextSize = 14  -- 更小的字体
ButtonIcon.Font = Enum.Font.GothamBold
ButtonIcon.Parent = VerifyButton

-- 状态显示（更紧凑）
local StatusArea = Instance.new("Frame")
StatusArea.Size = UDim2.new(0.85, 0, 0, 45)  -- 更矮
StatusArea.Position = UDim2.new(0.075, 0, 0.68, 0)
StatusArea.BackgroundTransparency = 1
StatusArea.Parent = MainContainer

local StatusBox = Instance.new("Frame")
StatusBox.Size = UDim2.new(1, 0, 1, 0)
StatusBox.BackgroundColor3 = Color3.fromRGB(25, 30, 40)
StatusBox.BackgroundTransparency = 0.8
StatusBox.Parent = StatusArea

local StatusBoxCorner = Instance.new("UICorner")
StatusBoxCorner.CornerRadius = UDim.new(0, 6)
StatusBoxCorner.Parent = StatusBox

local StatusIndicator = Instance.new("Frame")
StatusIndicator.Size = UDim2.new(0, 8, 0, 8)  -- 更小
StatusIndicator.Position = UDim2.new(0.05, 0, 0.5, -4)
StatusIndicator.BackgroundColor3 = Color3.fromRGB(120, 130, 150)
StatusIndicator.Parent = StatusBox

local StatusIndicatorCorner = Instance.new("UICorner")
StatusIndicatorCorner.CornerRadius = UDim.new(1, 0)
StatusIndicatorCorner.Parent = StatusIndicator

local StatusText = Instance.new("TextLabel")
StatusText.Size = UDim2.new(0.85, 0, 1, 0)
StatusText.Position = UDim2.new(0.15, 0, 0, 0)
StatusText.BackgroundTransparency = 1
StatusText.Text = "等待验证..."
StatusText.TextColor3 = Color3.fromRGB(170, 180, 200)
StatusText.TextSize = 12  -- 更小的字体
StatusText.Font = Enum.Font.GothamMedium
StatusText.TextXAlignment = Enum.TextXAlignment.Left
StatusText.Parent = StatusBox

-- 底部信息（更小）
local Footer = Instance.new("Frame")
Footer.Size = UDim2.new(1, 0, 0, 28)  -- 更矮
Footer.Position = UDim2.new(0, 0, 1, -28)
Footer.BackgroundColor3 = Color3.fromRGB(15, 20, 30)
Footer.BackgroundTransparency = 0.3
Footer.Parent = MainContainer

local VersionText = Instance.new("TextLabel")
VersionText.Size = UDim2.new(1, 0, 1, 0)
VersionText.BackgroundTransparency = 1
VersionText.Text = "v3.4 | 密钥验证系统"
VersionText.TextColor3 = Color3.fromRGB(120, 140, 160)
VersionText.TextSize = 10  -- 更小的字体
VersionText.Font = Enum.Font.Gotham
VersionText.Parent = Footer

-- 关闭按钮（更小）
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 22, 0, 22)  -- 更小
CloseButton.Position = UDim2.new(1, -26, 0, 6)
CloseButton.BackgroundColor3 = Color3.fromRGB(40, 45, 55)
CloseButton.AutoButtonColor = false
CloseButton.Text = "×"
CloseButton.TextColor3 = Color3.fromRGB(200, 210, 220)
CloseButton.TextSize = 16  -- 更小的字体
CloseButton.Font = Enum.Font.GothamBold
CloseButton.BorderSizePixel = 0
CloseButton.Parent = MainContainer

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0.5, 0)
CloseCorner.Parent = CloseButton

-- 添加小型外发光
local OuterGlow = Instance.new("ImageLabel")
OuterGlow.Size = UDim2.new(1, 16, 1, 16)  -- 更小的发光
OuterGlow.Position = UDim2.new(0, -8, 0, -8)
OuterGlow.BackgroundTransparency = 1
OuterGlow.Image = "rbxassetid://5554237733"
OuterGlow.ImageColor3 = Color3.fromRGB(0, 100, 200)
OuterGlow.ImageTransparency = 0.85
OuterGlow.ScaleType = Enum.ScaleType.Slice
OuterGlow.SliceCenter = Rect.new(23, 23, 277, 277)
OuterGlow.Parent = MainContainer
OuterGlow.ZIndex = -1

-- ================================
-- 修复的验证系统
-- ================================
local AuthSystem = {}

-- 有效密钥列表
AuthSystem.ValidKeys = {
    "渔炒鱼",
    " ",
    "SB",
    "傻逼",
    "MCBFUN",
}

-- 验证函数
function AuthSystem:validateKey(input)
    if not input or type(input) ~= "string" then
        return false, "请输入有效密钥"
    end
    
    local cleaned = input:gsub("%s+", "")
    
    if cleaned == "" then
        return false, "密钥不能为空"
    end
    
    for _, validKey in ipairs(self.ValidKeys) do
        if cleaned == validKey then
            return true, "验证成功！"
        end
    end
    
    return false, "密钥无效"
end

-- 执行脚本
function AuthSystem:executeScript()
    local url = "https://github.com/MCBFU/roblox/raw/refs/heads/main/pb.on1"
    
    local success, err = pcall(function()
        local scriptContent = game:HttpGet(url, true)
        if scriptContent then
            loadstring(scriptContent)()
        else
            error("无法获取脚本内容")
        end
    end)
    
    return success, err
end

-- ================================
-- 景深模糊效果控制
-- ================================
local function enableDepthBlur()
    local blurTween = TweenService:Create(DepthOfField, TweenInfo.new(0.8), {
        FarIntensity = 0.8,
        NearIntensity = 0.5,
        InFocusRadius = 50
    })
    blurTween:Play()
    return blurTween
end

local function disableDepthBlur()
    local blurTween = TweenService:Create(DepthOfField, TweenInfo.new(0.8), {
        FarIntensity = 0,
        NearIntensity = 0,
        InFocusRadius = 0
    })
    blurTween:Play()
    return blurTween
end

-- ================================
-- 动画工具
-- ================================
local function createTween(obj, props, time)
    local tween = TweenService:Create(obj, TweenInfo.new(time or 0.3), props)
    return tween
end

-- ================================
-- 显示UI并初始化
-- ================================
ScreenGui.Parent = Gui

-- 启用景深模糊
enableDepthBlur()

-- 播放入场动画（更居中）
local entranceTween = createTween(MainContainer, {
    Position = UDim2.new(0.5, -130, 0.5, -160),
    BackgroundTransparency = 0.1
}, 0.5)

entranceTween:Play()

-- 打印调试信息

-- ================================
-- 交互效果
-- ================================

-- 输入框效果
KeyInput.Focused:Connect(function()
    createTween(InputLine, {
        Size = UDim2.new(1, 0, 0, 2)
    }):Play()
    
    createTween(InputBox, {
        BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    }):Play()
end)

KeyInput.FocusLost:Connect(function()
    createTween(InputLine, {
        Size = UDim2.new(0, 0, 0, 2)
    }):Play()
    
    createTween(InputBox, {
        BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    }):Play()
end)

-- 验证按钮效果
VerifyButton.MouseEnter:Connect(function()
    createTween(VerifyButton, {
        BackgroundColor3 = Color3.fromRGB(0, 150, 230),
        Size = UDim2.new(0.72, 0, 0, 42)
    }, 0.2):Play()
    
    createTween(ButtonIcon, {
        Position = UDim2.new(1, -20, 0.5, -9)
    }, 0.3):Play()
end)

VerifyButton.MouseLeave:Connect(function()
    createTween(VerifyButton, {
        BackgroundColor3 = Color3.fromRGB(0, 130, 210),
        Size = UDim2.new(0.7, 0, 0, 40)
    }, 0.2):Play()
    
    createTween(ButtonIcon, {
        Position = UDim2.new(1, -22, 0.5, -9)
    }, 0.3):Play()
end)

-- 关闭按钮效果
CloseButton.MouseEnter:Connect(function()
    createTween(CloseButton, {
        BackgroundColor3 = Color3.fromRGB(50, 55, 65),
        Rotation = 90,
        Size = UDim2.new(0, 24, 0, 24)
    }, 0.3):Play()
end)

CloseButton.MouseLeave:Connect(function()
    createTween(CloseButton, {
        BackgroundColor3 = Color3.fromRGB(40, 45, 55),
        Rotation = 0,
        Size = UDim2.new(0, 22, 0, 22)
    }, 0.3):Play()
end)

-- ================================
-- 主验证功能
-- ================================
local function updateStatus(text, color)
    StatusText.Text = text
    StatusText.TextColor3 = color
    StatusIndicator.BackgroundColor3 = color
end

VerifyButton.MouseButton1Click:Connect(function()
    local input = KeyInput.Text
    
    if input == "" then
        updateStatus("请输入密钥", Color3.fromRGB(255, 150, 50))
        return
    end
    
    -- 显示验证中状态
    updateStatus("正在验证...", Color3.fromRGB(100, 200, 255))
    ButtonLabel.Text = "验证中..."
    
    -- 旋转动画
    local spinConnection
    local spinAngle = 0
    spinConnection = RunService.Heartbeat:Connect(function(delta)
        spinAngle = spinAngle + delta * 360
        StatusIndicator.Rotation = spinAngle
    end)
    
    wait(0.8)
    
    if spinConnection then
        spinConnection:Disconnect()
        StatusIndicator.Rotation = 0
    end
    
    -- 验证密钥
    local isValid, message = AuthSystem:validateKey(input)
    
    if isValid then
        updateStatus("✅ " .. message, Color3.fromRGB(100, 255, 100))
        
        -- 按钮状态更新
        ButtonLabel.Text = "启动中..."
        ButtonIcon.Text = "✓"
        
        wait(0.5)
        
        -- 执行脚本
        updateStatus("加载脚本中...", Color3.fromRGB(150, 220, 100))
        
        local success, err = AuthSystem:executeScript()
        
        if success then
            updateStatus("脚本启动成功！", Color3.fromRGB(100, 255, 100))
            
            -- 淡出效果并移除模糊
            createTween(MainContainer, {
                BackgroundTransparency = 1,
                Position = UDim2.new(0.5, -130, 0.5, -120)
            }, 0.8):Play()
            
            disableDepthBlur()
            
            wait(1)
            ScreenGui:Destroy()
        else
            updateStatus("脚本错误: " .. tostring(err), Color3.fromRGB(255, 100, 100))
            ButtonLabel.Text = "验证并启动"
            ButtonIcon.Text = "→"
        end
    else
        updateStatus("❌ " .. message, Color3.fromRGB(255, 100, 100))
        ButtonLabel.Text = "验证并启动"
        ButtonIcon.Text = "→"
        
        -- 错误震动效果
        createTween(MainContainer, {
            Position = UDim2.new(0.5, -130 + math.random(-4, 4), 0.5, -160)
        }, 0.1):Play()
        
        wait(0.1)
        
        createTween(MainContainer, {
            Position = UDim2.new(0.5, -130, 0.5, -160)
        }, 0.1):Play()
    end
end)

-- 回车键验证
KeyInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        VerifyButton:Click()
    end
end)

-- 关闭系统
CloseButton.MouseButton1Click:Connect(function()
    createTween(MainContainer, {
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, -130, 0.5, -180)
    }, 0.5):Play()
    
    disableDepthBlur()
    
    wait(0.8)
    ScreenGui:Destroy()
end)

-- 自动聚焦
wait(0.5)
KeyInput:CaptureFocus()

-- 设置初始状态
updateStatus("等待验证密钥...", Color3.fromRGB(170, 180, 200))

-- 确保UI显示
coroutine.wrap(function()
    wait(1)
    if ScreenGui and ScreenGui.Parent then
        print("✅ 小型UI显示正常")
        print("✅ 图片尺寸已缩小")
        print("✅ 窗口更加居中紧凑")
    else
        print("❌ UI未显示")
    end
end)()