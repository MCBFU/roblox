-- 【修复核心】贴图+音频批量替换模块 | 即时生效+动态监听+无遗漏
local replacementLists = {
    Images = {
        {oldId = "9819025862", newId = "5887957252"},--机器人进度
        {oldId = "18983980709", newId = "1883128632"},--死亡人类
        {oldId = "733082708", newId = "16876797391"},--残血人类
        {oldId = "18143239786", newId = "111333374680640"},--小猫吐舌
        {oldId = "17873701775", newId = "19005661344"},--票子框
        {oldId = "111766019087066", newId = "19005661344"},
        {oldId = "84173824340486", newId = "11419702905"},--盾牌技能
        {oldId = "80280801657905", newId = "12974453788"},--逃跑技能
        {oldId = "109696182350022", newId = "12974362186"},--医疗技能
        {oldId = "11245756484", newId = "11432834725"},--潜行技能
        {oldId = "3041611933", newId = "10709790644"},--G
        {oldId = "18984010733", newId = "11293978505"},--翻滚
        {oldId = "71894692127690", newId = "98446998103932"},--有名图片
        {oldId = "15459548442", newId = "28872862"},--盒子选择
        {oldId = "18457697895", newId = "1883128632"},--哈吉是怪
        {oldId = "17623366300", newId = "15236655346"},--老版本等候厅火车（开始按钮）
        {oldId = "113441953421169", newId = "98446998103932"},--月色下追逐
        {oldId = "7792025253", newId = "131794018998093"},--玩家列表未加载出来的人
        {oldId = "18983984311", newId = "12974446859"},--在地上趴着的人
        {oldId = "18983985638", newId = "15540208282"},--火车图案
        {oldId = "105124043854658", newId = "11295273292"},--怪物逃生阵营切换
        {oldId = "16244554485", newId = "77354540467357"},--等待
        {oldId = "13518130183", newId = "76846693971609"},--经验图标
        {oldId = "108218417623236", newId = "123922080862042"},--挣脱轮盘
        {oldId = "18983982189", newId = "18848424198"},--正常玩家
        {oldId = "18983983311", newId = "7361324455"},--已掉入管道的玩家
        {oldId = "18697280880", newId = "11963356747"},--管道标识
        {oldId = "117426859805043", newId = "12967561554"},--下拉机器
        {oldId = "112771731716467", newId = "98446998103932"},
        {oldId = "9367208286", newId = "11455761101"},--玩家失误提示
        {oldId = "11030033771", newId = "11963356747"},--怪物追人
        {oldId = "16771569388", newId = "76561912587311"},--蓝屏
        {oldId = "16307805649", newId = "10723433935"},--玩具部件
        {oldId = "16294678871", newId = "11419666746"},
        {oldId = "128541005752913", newId = "94698906864666"},--怪物红光
        {oldId = "71258592588220", newId = "11814673280"},--LOGO 
        {oldId = "483229625", newId = "11419666746"},--怪物准星圆圈
        {oldId = "483231231", newId = "11295275950"},-- 设置小房子
        {oldId = "8119252523", newId = "14187749511"},--获得经验票子弹窗
        {oldId = "96028253925505", newId = "14188388240"},--剩余命数
        {oldId = "18995086944", newId = "14188388240"},
        {oldId = "18984040900", newId = "11963364026"},--未知
        {oldId = "5107199773", newId = "100148515061030"},--第三人称
        {oldId = "13050415802", newId = "11422143201"},--下蹲
        {oldId = "18318977415", newId = "86119075739911"},--发射手按钮
        {oldId = "18318988523", newId = "86119075739911"},
        {oldId = "125028983718775", newId = "11295287158"},--上方收集进度框框 修复无效ID 000
        {oldId = "71943104392583", newId = "11419666512"},--爆米花机图案
        {oldId = "5887957252", newId = "11963364026"},--一个空心圆疑似准星
        {oldId = "5945121255", newId = "11963364026"},--追逐心跳特效
        {oldId = "11901680822", newId = "11963364026"},
        {oldId = "3124804643", newId = "11963364026"},
        {oldId = "9525535512", newId = "11422143469"},--跑路按钮
        {oldId = "112467754663467", newId = "85929246388579"},--背包图案
        {oldId = "74592393527729", newId = "98540618745439"},--大裤衩子
        {oldId = "114609020373684", newId = "103943763384616"},--鞋子
        {oldId = "123457018967026", newId = "138603836848808"},--帽子
        {oldId = "79899399105462", newId = "83549476158609"},--衣服
        {oldId = "129283713909372", newId = "16259096470"},--粉刷墙
        {oldId = "18848139891", newId = "12754479702"},--购买怪物选择框框
        {oldId = "18848327399", newId = "12817454402"},--返回
        {oldId = "18861353517", newId = "11963365322"},--更多怪物皮肤
        {oldId = "101804118103190", newId = "4625478089"},--玩具部件
        {oldId = "104232165431178", newId = "4625478089"},
        {oldId = "120452710152785", newId = "4625478089"},
        {oldId = "95825012919180", newId = "4625478089"},
        {oldId = "77823426566285", newId = "4625478089"},
        {oldId = "93426961710317", newId = "4625478089"},--
        {oldId = "18395608861", newId = "18132762977"},--票子
        {oldId = "7539983773", newId = "11432855214"},
    },
    Sounds = {        
        {old = "85947068032779", new = "11963364026"},--荡秋千
        {old = "17754462333", new = ""},--开启奔跑
        {old = "127588576195602", new = "16190782181"},--开启狂暴
        {old = "7048844460", new = "11963364026"},--机器人弹跳
        {old = "6027236630", new = "121714577724271"},--翻滚
        {old = "77641329246584", new = "121714577724271"},
        {old = "134749582867639", new = "121714577724271"},
        {old = "131298589984160", new = "121714577724271"},
        {old = "118826043355401", new = "121714577724271"},
        {old = "102502859803169", new = "9126102254"},--卷帘门
        {old = "90782284167817", new = "111358125948665"},--开始挣脱
        {old = "8509804480", new = "8509804480"},--机器人砍倒人
        {old = "6461775588", new = "8509804480"},
        {old = "6027236630", new = "119031191462818"},--板板跳跃
        {old = "119547018329590", new = "15689445424"},--火车逃离
        {old = "9042971851", new = "133701137571082"},--开启新地图游戏
        {old = "6794886454", new = "94624102598882"},--兔子音符盒
        {old = "268933841", new = "8400918001"},--落地
        {old = "1014740409", new = "94624102598882"},--小哈吉突脸
        {old = "6052548458", new = "7390036132"},
        {old = "81953263341178", new = "94624102598882"},
        {old = "4697381311", new = "94624102598882"},--哈吉冲刺突脸
        {old = "17779172376", new = "78979695510585"},--怪物选择界面
        {old = "105708271085646", new = "9040093731"},--最后结束
        {old = "15161202088", new = "9040093731"},
        {old = "70802680979187", new = "9040093731"},
        {old = "18580125132", new = "9040093731"},
        {old = "93555365323626", new = "6592039185"},--刚开游戏
        {old = "9047227058", new = "6698737249"},
        {old = "17754461645", new = "102635449518574"},--拍打玩家
        {old = "102227464743820", new = "1838285490"},--等候厅小曲
        {old = "18108930258", new = "86764987673138"},--从管道被救出
        {old = "4458750140", new = "79486256972927"},--骨折
        {old = "18108929583", new = "88694614773673"},--怪物胜利
        {old = "136847579", new = "4685847723"},--怪物是机器人
        {old = "17830578431", new = "9113988327"},--怪物是哈吉
        {old = "100117953439271", new = "1014740409"},--怪物是妈咪
        {old = "17830572203", new = "17830572203"},--怪物是盒子
        {old = "9125467397", new = "15746991650"},--爬起
        {old = "131136929849120", new = "166047422"},--挣脱成功
        {old = "18783467913", new = "106235104957151"},--集齐所有零件
        {old = "18108929972", new = "17754461645"},--被放入井道
        {old = "103208711906653", new = "15183765436"},--休闲时刻背景音乐
        {old = "125643578367125", new = "8400918001"},--你买不起
        {old = "130307677976118", new = "166047422"},--加载画面
        {old = "130307677976118", new = "166047422"},--举起玩家
        {old = "89226672351498", new = "93411834929338"},--妈咪突脸
        {old = "81665056647548", new = "93411834929338"},--盒子突脸
        {old = "5312518467", new = "70406650561771"},--下水道背景音
        {old = "120625154390198", new = "9120059083"},--卷帘门拉起
        {old = "9116385079", new = "166047422"},--开护盾
        {old = "115504092505776", new = "6592039185"},--以及其所有玩具
        {old = "9125844189", new = "79130056188513"},--机器人开脚步
        {old = "9113678359", new = "79130056188513"},
        {old = "9118398526", new = "79130056188513"},--机器人跳跃
        {old = "1837829154", new = "79486256972927"},--机器人撞到物体
        {old = "1837829473", new = "79486256972927"},
        {old = "9116698830", new = "79486256972927"},
        {old = "9116684733", new = "79130056188513"},--机器人空刀
        {old = "3521543186", new = "79130056188513"},
        {old = "125677551407985", new = "4685847723"},--机器人打到人
        {old = "4681189157", new = "5694665239"},
        {old = "4678745096", new = "5694665239"},
        {old = "4681189562", new = "5694665239"},
        {old = "112282490730834", new = ""},--发射手
        {old = "116093533132760", new = ""},
        {old = "116423712355422", new = ""},
        {old = "115504092505776", new = ""},--回收手
        {old = "106779899806168", new = ""},
        {old = "112771731716467", new = "79130056188513"},--拉动机器
        {old = "17856099558", new = ""},--爆米花机
        {old = "119794608146606", new = "104923055259541"},--标题界面等待音乐
        {old = "907514098", new = "6698737249"},--滑动标题界面按钮
        {old = "9119701012", new = "79130056188513"},--返回风声
    }
}

-- 修复点1：严谨的单个贴图替换（兼容所有图像类实例，强制匹配）
local function replaceSingleImage(obj, item)
    if not obj or not item or item.newId == "000" then return end
    local targetOld = "rbxassetid://" .. tostring(item.oldId)
    local targetNew = "rbxassetid://" .. tostring(item.newId)

    -- 覆盖所有图像相关属性，无遗漏
    pcall(function()
        if obj:IsA("ImageLabel") or obj:IsA("ImageButton") then
            if obj.Image == targetOld then obj.Image = targetNew end
        elseif obj:IsA("Decal") or obj:IsA("Texture") then
            if obj.Texture == targetOld then obj.Texture = targetNew end
        elseif obj:IsA("Sky") then
            if obj.SkyboxFt == targetOld then obj.SkyboxFt = targetNew end
            if obj.SkyboxBk == targetOld then obj.SkyboxBk = targetNew end
            if obj.SkyboxLf == targetOld then obj.SkyboxLf = targetNew end
            if obj.SkyboxRt == targetOld then obj.SkyboxRt = targetNew end
            if obj.SkyboxUp == targetOld then obj.SkyboxUp = targetNew end
            if obj.SkyboxDn == targetOld then obj.SkyboxDn = targetNew end
        end
    end)
end

-- 修复点2：严谨的单个音频替换（处理空ID场景，避免报错）
local function replaceSingleSound(obj, item)
    if not obj or not item or item.old == "" then return end
    local targetOld = "rbxassetid://" .. tostring(item.old)
    local targetNew = item.new == "" and "" or "rbxassetid://" .. tostring(item.new)

    pcall(function()
        if obj.SoundId == targetOld then
            obj.SoundId = targetNew
        end
    end)
end

-- 修复点3：批量替换现有对象（同步执行，优先覆盖，不丢对象）
local function replaceExistingObjects()
    -- 批量替换贴图
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("ImageLabel") or obj:IsA("ImageButton") or obj:IsA("Decal") or obj:IsA("Texture") or obj:IsA("Sky") then
            for _, item in ipairs(replacementLists.Images) do
                replaceSingleImage(obj, item)
            end
        end
    end

    -- 批量替换音频
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("Sound") then
            for _, item in ipairs(replacementLists.Sounds) do
                replaceSingleSound(obj, item)
            end
        end
    end
    print("✅ 现有贴图+音频替换完成！")
end

-- 修复点4：监听动态生成对象（实时拦截，新对象立即替换）
local function listenDynamicObjects()
    game.DescendantAdded:Connect(function(obj)
        task.spawn(function() -- 异步不阻塞主线程
            -- 动态贴图替换
            if obj:IsA("ImageLabel") or obj:IsA("ImageButton") or obj:IsA("Decal") or obj:IsA("Texture") or obj:IsA("Sky") then
                task.wait(0.01) -- 等待对象属性加载完整
                for _, item in ipairs(replacementLists.Images) do
                    replaceSingleImage(obj, item)
                end
            end
            -- 动态音频替换
            if obj:IsA("Sound") then
                task.wait(0.01)
                for _, item in ipairs(replacementLists.Sounds) do
                    replaceSingleSound(obj, item)
                end
            end
        end)
    end)
    print("✅ 动态对象监听已开启！后续生成的贴图/音频自动替换")
end

-- 修复点5：优化执行顺序+延迟适配，确保加载完成再替换
local function replaceAll()
    replaceExistingObjects() -- 先替换已有的
    listenDynamicObjects()   -- 再监听新生成的
end

-- 调整延迟，适配加载界面消失节奏，确保替换不被覆盖
task.wait(1.5)
replaceAll()
task.wait(0.5)
screenGui:Destroy()